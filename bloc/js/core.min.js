

checkLogin = function(user, pwd, type) {
    alert("here-");
    params = "method=check_login&user=" + user + "&pwd=" + pwd + "&type=" + type;
    loadXMLDoc('./controller/environment/login/webService0.php', params);
}
check_login = function(data) {
    var userLogged = document.getElementById("userLogged");
    var loginDiv=document.getElementById("loginDiv");
    var loggedDiv=document.getElementById("loggedDiv");
    if (data != "noData") {
        userData = JSON.parse(data);
        for(var j in userData){
            console.log(userData[j]);
        }
        var userName = userData.user;
        if(userData.result==="OK"){
            if(userData.type==1){
                userLogged.innerHTML = "<span style='font-size:8px;color:grey'>usuario:<span></br><span style='font-size:12px;color:blue'>"+userData.user+"<span>";
            }else if(userData.type==2){
                userLogged.innerHTML = "<span style='font-size:8px;color:grey'>organización:<span></br><span style='font-size:12px;color:blue'>"+userData.user+"<span>";
            }
            logged();
        }else{
            userData.type=0;
            userLogged.innerHTML = "Error en login. User not found";
            userLogged.innerHTML = "<span style='font-size:12px;color:blue'>Error en login. User not found<span>";
            loginDiv.style.display="inline-block";
            loggedDiv.style.display="none";
        }
    } else {
        userData.type=0;
        userLogged.innerHTML = "Error en login. User not found";
    }
}

iniLogin = function(){
    var userLogged = document.getElementById("userLogged");
    var loginDiv=document.getElementById("loginDiv");
    var loggedDiv=document.getElementById("loggedDiv");
    if(userData.user){
        if(userData.type==1){
                userLogged.innerHTML = userData.nick;
            }else if(userData.type==2){
                userLogged.innerHTML = userData.nick;
            }else if(userData.type==0){
                userLogged.innerHTML = userData.nick;
            }
            userLogged.user= userData.user;
            userLogged.pwd= userData.pwd;
            userLogged.type= userData.type;
            userLogged.nick= userData.nick;
            //poder crear contenidos
            userLogged.privContent= userData.privContent;
            //acceder a contenidos privados
            userLogged.privAccess= userData.privAccess;
            if(userData.privAccess){
                loggedPrivate = true;
            }else{
                loggedPrivate = false;
            }
            //login genérico
            logged=true;
    
    }else{
        loginDiv.style.display="inline-block";
        loggedDiv.style.display="none";
        userLogged.innerHTML = "Login";
    }
}
function logged(){
    var loginDiv=document.getElementById("loginDiv");
    var loggedDiv=document.getElementById("loggedDiv");
    document.getElementById("loggedDivUser").innerHTML=userData["user"];
     loginDiv.style.display="none";
     loggedDiv.style.display="inline-block";
}
var logOutFunc=null;
function logOut(_loginOut){
    logOutFunc=_loginOut;
    var obj={};
    obj.exec=_loginOut;
    
    $.ajax({
            url: CONFIG["adminFolder"]+'/controller/environment/multipleUser/logout.php',
            type: 'POST',
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function () {
            },
            //una vez finalizado correctamente
            success: function (data) {
                    loggedPrivate=false;
                        logged=false;
                    if(logOutFunc){
                        logOutFunc();
                    }else{
                        
                        alert("session destroyed");
                    }
            },
            //si ha ocurrido un error
            error: function () {
            }
        });
}




var ads={
    "rot":{"es":"Espacio reservado para publicidad","en":"Reserved for adverts"},
    "config":{"es":"Se puede ocultar o mostrar en cada clip","en":"Show or hide for each clip"}
}
createAdv=function(date,adCode){
    var AdDiv=document.createElement("div");
    AdDiv.id="adContainner";
    AdDiv.className="col-xs-2 nopadding adContainner";
    if(window.innerWidth<1280){
        var mainContent = document.getElementById("date");
            if (submenuExists) {
                 mainContent.style.width = "83.33333333%";
                mainContent.className = "col-xs-10 nopadding generic_trans_basic";
            } else {
                mainContent.style.width = "100%";
                mainContent.className = "col-xs-12 nopadding generic_trans_basic";
            }
            
        AdDiv.style.opacity=0;
    }
    var destiny=document.getElementById("date");
    var pasteIn=destiny.nextSibling;
    destiny.parentNode.insertBefore(AdDiv,pasteIn);
    AdDiv.innerHTML = "<div id='extendAd' onclick='extendAd(\""+date+"\")'>Extend</div><div id='adContentContainner'></div>";
    if(adCode!=undefined && adCode!=""){
        $("#adContentContainner").load(adCode, function() {
    
        });
    }
    
    
}
extendAd=function(date){
    var adDiv=document.getElementById("adContainner");
    var adDivCloned=adDiv.cloneNode(true);
    adDivCloned.className="adDivCloned";
    adDivCloned.id="adDivCloned";
    document.getElementById("extendAd").id="extendAd_old";
     var posTop=document.getElementById("headerContainer").offsetHeight;
    adDivCloned.style.top=posTop+"px";
    adDivCloned.style.left=adDiv.offsetLeft+"px";
    document.body.appendChild(adDivCloned);
    var newCloseAd=document.getElementById("extendAd");
    newCloseAd.innerHTML="Close";
    newCloseAd.style.right=0;
    newCloseAd.onclick=function(){ closeAd()};
   
    
    setTimeout(function() {
        adDivCloned.style.left="0px";
        endTrans=function(){
            endTrans=null;
            adDivCloned.style.top="0px";
        }
    }, 10);
}
closeAd=function(){
    var cloned=document.getElementById("adDivCloned");
    cloned.style.left="100%";
    endTrans=function(){
        endTrans=null;
        document.body.removeChild(cloned);
        document.getElementById("extendAd_old").id="extendAd";
    }
}


record_stats=function(date){
    params = "method=stats_saved&DIR=../../../../pages/"+date+"&URL=../../../../pages/"+date+"/stats.txt";
    loadXMLDoc('./admin/controller/environment/stats/counter.php', params);
}
stats_saved=function(data){
        document.getElementById("counter").innerHTML = data;
}





/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

var userLogged = {};
var logged = false;
var loggedPrivate = false;
clipblocLogin = function(func, noFunc, whileFunc) {
    if (whileFunc) {
        whileFunc();
    }
    var user = document.getElementById("user").value;
    var pwd = document.getElementById("password").value;
    if (document.getElementById("status")) {
        var status = document.getElementById("status");
    }
    var obj = {};
    obj.USER = user;
    obj.PWD = pwd;
    if (status) {
        status.innerHTML = CONFIG["ckeckingRot"];
    }
    $.ajax({
        url: './admin/controller/environment/multipleUser/checkUser.php',
        //usando GET because string has special characters
        type: 'GET',
        // Form data
        //datos del formulario
        //data: formData,
        data: obj,
        //mientras enviamos el archivo
        beforeSend: function() {
            //showMessageUsers("Guardando");
        },
        //una vez finalizado correctamente
        success: function(data) {
            if (data == "User Incorrecto") {
                if (status) {
                    status.innerHTML = "User No OK";
                }
                userLogged = {};
                logged = false;
                loggedPrivate = false;
                var user = document.getElementById("userLogged");
                user.innerHTML = "";
                if (noFunc) {
                    noFunc();
                }
            } else if (data == "Blocked") {
                if (status) {
                    status.innerHTML = "Blocked";
                }
                userLogged = {};
                logged = false;
                loggedPrivate = false;
                var user = document.getElementById("userLogged");
                user.innerHTML = "";
                if (noFunc) {
                    noFunc();
                }
            } else if (data == "Incorrecto") {
                if (status) {
                    status.innerHTML = "No OK";
                }
                userLogged = {};
                logged = false;
                loggedPrivate = false;
                user = document.getElementById("userLogged");
                user.innerHTML = "";
                if (noFunc) {
                    noFunc();
                }
            } else {
                userLogged = JSON.parse(data);
                logged = true;
                if (userLogged["privAccess"]) {
                    loggedPrivate = true;
                }
                user = document.getElementById("userLogged");
                user.innerHTML = userLogged["nick"];
                if (status) {
                    status.innerHTML = "OK";
                }
                if (func) {
                    func();
                }

            }



        },
        //si ha ocurrido un error
        error: function() {
            if (status) {
                status.innerHTML = "No OK";
            }
            userLogged = {};
            logged = false;
            loggedPrivate = false;
            user = document.getElementById("userLogged");
            user.innerHTML = "";
        }
    });
}
var _endFunc=null;
checkLogged = function(func, noFunc, whileFunc,endFunc) {
    if (whileFunc) {
        whileFunc();
    }
    if (!logged) {
        if (noFunc) {
            noFunc();
        }
    } else {
        if (document.getElementById("status")) {
            var status = document.getElementById("status");
        }
        var obj = {};
        obj.USER = userLogged["user"];
        obj.PWD = userLogged["pwd"];
        if(bridgeRef){
            obj.BRIDGE = bridgeRef;
        }
        if (status) {
            status.innerHTML = CONFIG["ckeckingRot"];
        }
        $.ajax({
            url: './admin/controller/environment/multipleUser/checkUser.php',
            //usando GET because string has special characters
            type: 'GET',
            // Form data
            //datos del formulario
            //data: formData,
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function() {
                //showMessageUsers("Guardando");
            },
            //una vez finalizado correctamente
            success: function(data) {
                if (data == "User Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Blocked") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else {
                    if (func) {
                        func();
                    }
                    if(endFunc){
                        _endFunc=endFunc;
                    }
                    if (lastSubPage) {
                        var toPage = lastSubPage.id.replace("page_", "");
                    } else {
                        toPage = lastPage.id.replace("page_menu_", "");
                    }
                    
                    if(typeof bridgeActive!=="undefined" && bridgeActive){
                        toPage=toPage.replace("_bridge","");
                    }
                    
                    
                    /*var CUERPO = encodeURIComponent(document.getElementById("date").innerHTML);
                    var params = "method=save_page_user&BRIDGE="+bridgeRef+"+&CUERPO=" + CUERPO + "&URL=../../../pages/" + toPage + ".html";
                    if(typeof bridgeActive!=="undefined" && bridgeActive){
                        loadXMLDoc(bridgeActivePath+'/admin/controller/environment/saveBridge.php', params);
                    }else{
                        loadXMLDoc('./admin/controller/environment/save.php', params);
                    }*/
                    var CUERPO = document.getElementById("date").innerHTML;
                    CUERPO=CUERPO.replace(/\\/g, '\\\\');
                    var obj2 = {};
                    obj2.BRIDGE = bridgeRef;
                    obj2.CUERPO = CUERPO;
                    obj2.URL = "../../../pages/" + toPage + ".html";
                    
                    
                    if(typeof bridgeActive!=="undefined" && bridgeActive){
                        obj2.service=bridgeActivePath+'/admin/controller/environment/saveBridge.php';
                    }else{
                        obj2.service='./admin/controller/environment/save.php';
                    }
                    $.ajax({
                        url: obj2.service,
                        //usando GET because string has special characters
                        type: 'POST',
                        // Form data
                        //datos del formulario
                        //data: formData,
                        data: obj2,
                        //mientras enviamos el archivo
                        beforeSend: function() {
                            //showMessageUsers("Guardando");
                        },
                        //una vez finalizado correctamente
                        success: function(data) {
                            save_page_user(data);
                        },
                        //si ha ocurrido un error
                        error: function() {
                        }
                    });

                }

            },
            //si ha ocurrido un error
            error: function() {
                if (noFunc) {
                    noFunc();
                }
            }
        });
    }

}
var contentClean = null;
saveLoggedUserContent = function(func, noFunc, whileFunc,endFunc) {
    if (whileFunc) {
        whileFunc();
    }
    if (!logged) {
        if (noFunc) {
            noFunc();
        }
    } else {
        var obj = {};
        obj.USER = userLogged["user"];
        obj.PWD = userLogged["pwd"];
        $.ajax({
            url: './admin/controller/environment/multipleUser/checkUser.php',
            //usando GET because string has special characters
            type: 'GET',
            // Form data
            //datos del formulario
            //data: formData,
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function() {
                //showMessageUsers("Guardando");
            },
            //una vez finalizado correctamente
            success: function(data) {
                if (data == "User Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Blocked") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else {
                    if (lastSubPage) {
                        var toPage = lastSubPage.id.replace("page_", "");
                    } else {
                        toPage = lastPage.id.replace("page_menu_", "");
                    }
                    if(endFunc){
                        _endFunc=endFunc;
                    }
                    var CUERPO = encodeURIComponent(document.getElementById("tempContent").innerHTML);

                    var params = "method=save_page_user&CUERPO=" + CUERPO + "&URL=../../../pages/" + toPage + "/" + toPage + "_" + userLogged["user"] + ".html";
                    loadXMLDoc('./admin/controller/environment/save.php', params);
                    if (func) {
                        func();
                    }
                    

                }

            },
            //si ha ocurrido un error
            error: function() {
                if (noFunc) {
                    noFunc();
                }
            }
        });
    }
}
save_page_user = function(data) {
    if(_endFunc){
        _endFunc();
        _endFunc=null;
    }
}
checkLoggedUserContent = function(func, noFunc, whileFunc, noContent) {
    if (whileFunc) {
        whileFunc();
    }
    if (!logged) {
        noFunc();
    } else {

        var obj = {};
        obj.USER = userLogged["user"];
        obj.PWD = userLogged["pwd"];
        $.ajax({
            url: './admin/controller/environment/multipleUser/checkUser.php',
            //usando GET because string has special characters
            type: 'GET',
            // Form data
            //datos del formulario
            //data: formData,
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function() {
                //showMessageUsers("Guardando");
            },
            //una vez finalizado correctamente
            success: function(data) {
                if (data == "User Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Blocked") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else {
                    if (lastSubPage) {
                        var toPage = lastSubPage.id.replace("page_", "");
                    } else {
                        toPage = lastPage.id.replace("page_menu_", "");
                    }
                    var refresh = new Date().getTime();
                    if (!contentClean) {
                        contentClean = document.getElementById("tempContent").innerHTML;
                    }
                    $("#tempContent").load("./pages/" + toPage + "/" + toPage + "_" + userLogged["user"] + ".html?" + refresh, function(response, status, xhr) {
                        if (status == "error") {
                            document.getElementById("tempContent").innerHTML = contentClean;
                            if (noContent) {
                                noContent();
                            }
                        }
                        if (func) {
                            func();
                        }
                    });
                }

            },
            //si ha ocurrido un error
            error: function() {
                if (noFunc) {
                    noFunc();
                }
            }
        });
    }
}


checkLoggedAdmin = function(func, noFunc, whileFunc) {
    if (whileFunc) {
        whileFunc();
    }
    if (!logged) {
        noFunc();
    } else {
        var obj = {};
        obj.USER = userLogged["user"];
        obj.PWD = userLogged["pwd"];
        $.ajax({
            url: './admin/controller/environment/multipleUser/checkUserAdmin.php',
            //usando GET because string has special characters
            type: 'GET',
            // Form data
            //datos del formulario
            //data: formData,
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function() {
                //showMessageUsers("Guardando");
            },
            //una vez finalizado correctamente
            success: function(data) {
                if (data == "User Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Blocked") {
                    if (noFunc) {
                        noFunc();
                    }
                } else if (data == "Incorrecto") {
                    if (noFunc) {
                        noFunc();
                    }
                } else {
                    if (func) {
                        func();
                    }
                    params = "method=readMultipleUser";
                    loadXMLDoc('./admin/controller/environment/multipleUser/multipleUserList.php', params);
                }

            },
            //si ha ocurrido un error
            error: function() {
                if (noFunc) {
                    noFunc();
                }
            }
        });
    }
}


var listUserDiv=null;
var listUserDivContent=null;
var multipleUserData = null;
var multipleUserList = {};
var abc=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];
var tabsUser =null;
read_MultipleUser = function(data) {
    multipleUserData = JSON.parse(data);
    fromOnlineReg=false;
    if (!listUserDiv) {
        listUserDiv = document.createElement("div");
        listUserDiv.id = "listUserDiv";
        listUserDiv.className = "listUserDiv generic_trans";
        document.body.appendChild(listUserDiv);
        var close = document.createElement("div");
        close.className = "close";
        close.id = "closeListUserDiv";
        close.innerHTML = "close";
        listUserDiv.appendChild(close);
        close.onclick = function() {
            listUserDiv.style.left = "-100%";
            endTrans = function() {
                endTrans = null;
            }
        };
        listUserDivContent = document.createElement("div");
        listUserDivContent.id = "listUserDivContent";
        listUserDiv.appendChild(listUserDivContent);
    }
    
    $("#listUserDivContent").load("./pages/multipleUser.html", function() {
        var usersRegList = document.getElementById("usersRegList");
        var ownUsers = document.createElement("div");
        ownUsers.innerHTML = "own";
        ownUsers.id="ownUsers";
        ownUsers.className = "ownUsers";
        ownUsers.onclick = function() {
            fromOnlineReg = false;
            checkLoggedAdmin();
        }
        usersRegList.appendChild(ownUsers);
        for (var j in abc) {
            var abcItem = document.createElement("div");
            abcItem.id = "item_" + abc[j];
            abcItem.innerHTML = abc[j];
            abcItem.className = "itemABC";
            usersRegList.appendChild(abcItem);
            abcItem.onclick = function() {
                showRegOnline(event.target.innerHTML);
            }
        }
        tabsUser = new users();
        ko.applyBindings(tabsUser, document.getElementById("usersList_content"));
        tabsUser.ini();
        setTimeout(function() {
            listUserDiv.style.left = "0%";
            endTrans = function() {
                endTrans = null;
            }
        }, 10);

    });
}
var fromOnlineReg=false;
function showRegOnline(_itemABC){
    fromOnlineReg=true;
    var obj = {};
    obj.itemABC = _itemABC;
    $.ajax({
        url: './admin/controller/environment/dirs/usersRegList.php',
        //usando GET because string has special characters
        type: 'POST',
        // Form data
        //datos del formulario
        //data: formData,
        data: obj,
        //mientras enviamos el archivo
        beforeSend: function() {
        },
        //una vez finalizado correctamente
        success: function(data) {
            multipleUserData=data.items;
            tabsUser.ini();
        },
        //si ha ocurrido un error
        error: function() {
            
        }
    });
}
function users() {
    var self = this;
    self.tabs = ko.observableArray();
    self.ini = function() {
        self.tabs(multipleUserData);
    };
    self.selUser = function(tab) {
        if(fromOnlineReg){
            checkLoggedUserContentAdmin(tab.email, tab.pwd,tab.name);
        }else{
            checkLoggedUserContentAdmin(tab.user, tab.pwd,tab.name);
        }
        
    };

}
var tempUser = null;
checkLoggedUserContentAdmin = function(_user, _pwd,_name) {
    setTimeout(function() {
        listUserDiv.style.left = "-100%";
        endTrans = function() {
            endTrans = null;
        }
    }, 10);
    tempUser = _user;
    tempName = _name;
    try {
        _whileFunc();
    }
    catch (err) {

    }
    if (!logged) {
        try {
            _noFunc();
        }
        catch (err) {

        }

    } else {

        var obj = {};
        obj.USER = _user;
        obj.PWD = _pwd;
        $.ajax({
            url: './admin/controller/environment/multipleUser/checkUserTemp.php',
            //usando GET because string has special characters
            type: 'GET',
            // Form data
            //datos del formulario
            //data: formData,
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function() {
                //showMessageUsers("Guardando");
            },
            //una vez finalizado correctamente
            success: function(data) {
                if (data == "User Incorrecto") {
                    try {
                        _noFunc();
                    }
                    catch (err) {

                    }
                } else if (data == "Blocked") {
                    try {
                        _noFunc();
                    }
                    catch (err) {

                    }
                } else if (data == "Incorrecto") {
                    try {
                        _noFunc();
                    }
                    catch (err) {

                    }
                } else {
                    if (lastSubPage) {
                        var toPage = lastSubPage.id.replace("page_", "");
                    } else {
                        toPage = lastPage.id.replace("page_menu_", "");
                    }
                    var refresh = new Date().getTime();
                    if (!contentClean) {
                        contentClean = document.getElementById("tempContent").innerHTML;
                    }
                    $("#tempContent").load("./pages/" + toPage + "/" + toPage + "_" + tempUser + ".html?" + refresh, function(response, status, xhr) {

                        if (status == "error") {
                            document.getElementById("tempContent").innerHTML = contentClean;
                            if (_noContent) {
                                _noContent();
                            }
                        }
                        try {
                            _func();
                        }
                        catch (err) {

                        }
                        tempUser = null;
                    });
                }

            },
            //si ha ocurrido un error
            error: function() {
                try {
                    _noFunc();
                }
                catch (err) {

                }
            }
        });
    }
}


clipblocLoginPrivate = function(func, noFunc, whileFunc) {
    if (whileFunc) {
        whileFunc();
    }
    var user = document.getElementById("user").value;
    var pwd = document.getElementById("password").value;
    if (document.getElementById("status")) {
        var status = document.getElementById("status");
    }
    var obj = {};
    obj.USER = user;
    obj.PWD = pwd;
    if (status) {
        status.innerHTML = CONFIG["ckeckingRot"];
    }
    $.ajax({
        url: './admin/controller/environment/multipleUser/checkUserPrivate.php',
        //usando GET because string has special characters
        type: 'GET',
        // Form data
        //datos del formulario
        //data: formData,
        data: obj,
        //mientras enviamos el archivo
        beforeSend: function() {
            //showMessageUsers("Guardando");
        },
        //una vez finalizado correctamente
        success: function(data) {
            if (data == "User Incorrecto") {
                if (status) {
                    status.innerHTML = "User No OK";
                }
                userLogged = {};
                logged = false;
                var user = document.getElementById("userLogged");
                user.innerHTML = "";
                if (noFunc) {
                    noFunc();
                }
            } else if (data == "Blocked") {
                if (status) {
                    status.innerHTML = "Blocked";
                }
                userLogged = {};
                logged = false;
                var user = document.getElementById("userLogged");
                user.innerHTML = "";
                if (noFunc) {
                    noFunc();
                }
            } else if (data == "Incorrecto") {
                if (status) {
                    status.innerHTML = "No OK";
                }
                userLogged = {};
                logged = false;
                user = document.getElementById("userLogged");
                user.innerHTML = "";
                if (noFunc) {
                    noFunc();
                }
            } else {
                userLogged = JSON.parse(data);
                logged = true;
                if (userLogged["privAccess"]) {
                    loggedPrivate = true;
                }
                user = document.getElementById("userLogged");
                user.innerHTML = userLogged["nick"];
                if (status) {
                    status.innerHTML = "OK";
                }
                if (func) {
                    func();
                }
                privateAccess();
                privateAccess = null;
                //acumula la acción cuando el login se encuentra en otro clip
                if(privateAccess_ori){
                    privateAccess_ori();
                    privateAccess_ori=null;
                }

            }



        },
        //si ha ocurrido un error
        error: function() {
            if (status) {
                status.innerHTML = "No OK";
            }
            userLogged = {};
            logged = false;
            user = document.getElementById("userLogged");
            user.innerHTML = "";
        }
    });
}


checkLoggedUserPrivate = function() {
    if (!loggedPrivate) {
        checkLoginPrivate();
    } else {
        privateAccess();
        privateAccess = null;
    }
}
var loginPrivate = null;
checkLoginPrivate = function() {
    if (loginPrivate) {
        loginPrivate();
    } else {
        auxLoginPrivate();
    }
}
auxLoginPrivate = function() {
    alert("Contenido Privado");
}
function validarEmail( email ) {
    var expr = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    if ( !expr.test(email) ){
        return false;
    }else{
        return true;
    }
}
function ltrim(str, filter) {
  var i = str.length;
  filter || ( filter = '' );
  for (var k = 0; k < i && filtering(str.charAt(k), filter); k++);
  return str.substring(k, i);
}
function rtrim(str, filter) {
  filter || ( filter = '' );
  for (var j = str.length - 1; j >= 0 && filtering(str.charAt(j), filter); j--);          
  return str.substring(0, j + 1);
}
function trim(str, filter) {
  filter || ( filter = '' );
  return ltrim(rtrim(str, filter), filter);
}
function filtering(charToCheck, filter) {
  filter || ( filter = " \t\n\r\f" );
  return (filter.indexOf(charToCheck) != -1);
}
registerCore=function(_registerData,regOkFunc,regWhileFunc,regNokFunc,regErrorFunc){
    if (typeof regWhileFunc !== "undefined") {
                            regWhileFunc();
                        } 
    var message="";
    var obj = {};
    obj.NAME = trim(_registerData.name);
    obj.USER = trim(_registerData.user);
    obj.PWD = trim(_registerData.password);
    obj.PWDREPIT = trim(_registerData.passwordRepit);
    obj.EMAIL = trim(_registerData.email);
    if(document.getElementById("status")){
        document.getElementById("status").innerHTML="";
    }
    
    var dataRegOK=true;
    var wrongData;
    
    dataRegOK=validarEmail(obj.EMAIL);
    
    if(!dataRegOK){
        message=rots["REGEMAILNOK"][lanTemp];
        wrongData="REGEMAILNOK";
    }
    
    if (obj.NAME == null || obj.NAME.length == 0 || /^\s*$/.test(obj.NAME)
            || obj.USER == null || obj.USER.length == 0 || /^\s*$/.test(obj.USER)
            || obj.PWD == null || obj.PWD.length == 0 || /^\s*$/.test(obj.PWD)
            || obj.PWDREPIT == null || obj.PWDREPIT.length == 0 || /^\s*$/.test(obj.PWDREPIT)
            || obj.EMAIL == null || obj.EMAIL.length == 0 || /^\s*$/.test(obj.EMAIL)
    ){   
         dataRegOK=false;
         message=rots["REGNOEMPTY"][lanTemp];
         wrongData="REGNOEMPTY";
    }
    
    if(obj.PWD!==obj.PWDREPIT){
        dataRegOK=false;
        message=rots["REGPWDNOK"][lanTemp];
        wrongData="REGPWDNOK";
    }
    obj.BLOCNAME=CONFIG["logo"];
    obj.MESSAGE=rots["CONFIRMMESSAGE"][lanTemp];
    obj.REPLY=CONFIG["email"];
    obj.CODE=new Date().getTime();
    if(dataRegOK){
            $.ajax({
                url: './admin/controller/environment/multipleUser/registerUserTemp.php',
                //usando GET because string has special characters
                type: 'POST',
                // Form data
                //datos del formulario
                //data: formData,
                data: obj,
                //mientras enviamos el archivo
                beforeSend: function() {
                    //showMessageUsers("Guardando");
                },
                //una vez finalizado correctamente
                success: function(data) {
                    if(data === "EXISTSTEMP"){
                        if (typeof regOkFunc !== "undefined") {
                            regOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["TEMPREG"][lanTemp];
                            }else{
                                alert(rots["TEMPREG"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if (data === "ACTIVEREG") {
                        if (typeof regOkFunc !== "undefined") {
                            regOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["ACTIVEREG"][lanTemp];
                            }else{
                                alert(rots["ACTIVEREG"][lanTemp]+" ( Default message )");
                            }

                        }
                    } else if (data === "EXISTS") {
                        if (typeof regOkFunc !== "undefined") {
                            regOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGEXIST"][lanTemp];
                            }else{
                                alert(rots["REGEXIST"][lanTemp]+" ( Default message )");
                            }

                        }
                    } else if(data === "OK"){
                        if (typeof regOkFunc !== "undefined") {
                            regOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGOK"][lanTemp];
                            }else{
                                alert(rots["REGOK"][lanTemp]+" ( Default message )");
                            }

                        }
                    }



                },
                //si ha ocurrido un error
                error: function() {
                    if (typeof regErrorFunc !== "undefined") {
                            regErrorFunc();
                        } else {
                    if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGERROR"][lanTemp];
                            }else{
                                alert(rots["REGERROR"][lanTemp]+" ( Default message )");
                            }
                        }
                }
            });
    }else{
        if (typeof regNokFunc !== "undefined") {
            regNokFunc(wrongData);
        } else {
            if (document.getElementById("status")) {
                document.getElementById("status").innerHTML = message;
            } else {
                alert(message + " ( Default message )");
            }
        }
    }
}
registerConfirmCore=function(_registerData,regConfirmOkFunc,regConfirmWhileFunc,regConfirmNokFunc,regConfirmErrorFunc){
    if (typeof regConfirmWhileFunc !== "undefined") {
                            regConfirmWhileFunc();
                        } 
    var message="";
    var obj = {};
    obj.CODE = trim(_registerData.confirmCode);
    obj.EMAIL = trim(_registerData.email);
    if(document.getElementById("status")){
        document.getElementById("status").innerHTML="";
    }
    
    var dataRegOK=true;
    var wrongData;
    dataRegOK=validarEmail(obj.EMAIL);
    
    if(!dataRegOK){
        message=rots["REGEMAILNOK"][lanTemp];
        wrongData="REGEMAILNOK";
    }
    
    if ( obj.CODE == null || obj.CODE.length == 0 || /^\s*$/.test(obj.CODE) || obj.EMAIL == null || obj.EMAIL.length == 0 || /^\s*$/.test(obj.EMAIL)
    ){   
         dataRegOK=false;
         message=rots["REGNOEMPTY"][lanTemp];
         wrongData="REGNOEMPTY";
    }
    
    if(dataRegOK){
            $.ajax({
                url: './admin/controller/environment/multipleUser/registerConfirmUserTemp.php',
                //usando GET because string has special characters
                type: 'POST',
                // Form data
                //datos del formulario
                //data: formData,
                data: obj,
                //mientras enviamos el archivo
                beforeSend: function() {
                    //showMessageUsers("Guardando");
                },
                //una vez finalizado correctamente
                success: function(data) {
                    if(data === "WASCONFIRMED"){
                        if (typeof regConfirmOkFunc !== "undefined") {
                            regConfirmOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["WASCONFIRMED"][lanTemp];
                            }else{
                                alert(rots["WASCONFIRMED"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if (data === "NOTEXISTS") {
                        if (typeof regConfirmOkFunc !== "undefined") {
                            regConfirmOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["ACTIVECONFIRMREGNOTEXISTS"][lanTemp];
                            }else{
                                alert(rots["ACTIVECONFIRMREGNOTEXISTS"][lanTemp]+" ( Default message )");
                            }

                        }
                    } else if (data === "NOK") {
                        if (typeof regConfirmOkFunc !== "undefined") {
                            regConfirmOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["ACTIVECONFIRMREGNOK"][lanTemp];
                            }else{
                                alert(rots["ACTIVECONFIRMREGNOK"][lanTemp]+" ( Default message )");
                            }

                        }
                    } else if(data === "OK"){
                        if (typeof regConfirmOkFunc !== "undefined") {
                            regConfirmOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGCONFIRMOK"][lanTemp];
                            }else{
                                alert(rots["REGCONFIRMOK"][lanTemp]+" ( Default message )");
                            }

                        }
                    }



                },
                //si ha ocurrido un error
                error: function() {
                    if (typeof regConfirmErrorFunc !== "undefined") {
                            regConfirmErrorFunc();
                        } else {
                    if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGCONFIRMERROR"][lanTemp];
                            }else{
                                alert(rots["REGCONFIRMERROR"][lanTemp]+" ( Default message )");
                            }
                        }
                }
            });
    }else{
        if (typeof regConfirmNokFunc !== "undefined") {
            regConfirmNokFunc(wrongData);
        } else {
            if (document.getElementById("status")) {
                document.getElementById("status").innerHTML = message;
            } else {
                alert(message + " ( Default message )");
            }
        }
    }
}
var saveForce=function(){
    this.dateForce=new Date().getTime();
    this.beforeForce=historyDate[historyDatePointer][2];
    setTimeout(function() {
        force=null;
        historyDate[historyDatePointer][2]=null;
        //historyDate[0][2]=null;
        this.beforeForce=null;
        this.dateForce===null;
        console.log("fin");
    }, 1000);
}
checkLoggedForce = function(_dateForce,_beforeForce,_forceFunc) {
    if(/*typeof historyDate[0][2] !=="undefined" && historyDate[0][2]!=null &&*/ typeof afterTransitionFunc!=="undefined" && afterTransitionFunc && _dateForce!=null && force.dateForce===_dateForce && _beforeForce && force.beforeForce===_beforeForce && _beforeForce===historyDate[historyDatePointer][2] && historyDate[historyDatePointer][2]!=
null){ 
        if(typeof _forceFunc!=="undefined" && _forceFunc){
            _forceFunc();
        }
        _forceFunc=null;
        afterTransitionFunc=null;
        if (lastSubPage) {
            var toPage = lastSubPage.id.replace("page_", "");
        } else {
            toPage = lastPage.id.replace("page_menu_", "");
        }

        if (typeof bridgeActive !== "undefined" && bridgeActive) {
            toPage = toPage.replace("_bridge", "");
        }
        var CUERPO = encodeURIComponent(document.getElementById("date").innerHTML);
        var params = "method=save_page_user&BRIDGE=" + bridgeRef + "+&CUERPO=" + CUERPO + "&URL=../../../pages/" + toPage + ".html";

        if (typeof bridgeActive !== "undefined" && bridgeActive) {
            loadXMLDoc(bridgeActivePath + '/admin/controller/environment/saveBridge.php', params);
        } else {
            loadXMLDoc('./admin/controller/environment/save.php', params);
        }
    }else{
        afterTransitionFunc=null;
    }
    
}
recoverCode=function(_dataCode,recoverCodeOkFunc,recoverCodeWhileFunc,recoverCodeNokFunc,regErrorFunc){
    if (typeof recoverCodeWhileFunc !== "undefined") {
                            recoverCodeWhileFunc();
                        } 
    var message="";
    var obj = {};
    obj.EMAIL = trim(_dataCode.email);
    obj.BLOCNAME=_dataCode.logo;
    obj.MESSAGE=_dataCode.MESSAGE;
    obj.MESSAGEPENDING=_dataCode.MESSAGEPENDING;
    obj.REPLY=_dataCode.REPLY;
    if(document.getElementById("status")){
        document.getElementById("status").innerHTML="";
    }
    
    var dataRegOK=true;
    var wrongData;
    
    dataRegOK=validarEmail(obj.EMAIL);
    
    if(!dataRegOK){
        message=rots["REGEMAILNOK"][lanTemp];
        wrongData="REGEMAILNOK";
    }
    
    if(dataRegOK){
            $.ajax({
                url: './admin/controller/environment/multipleUser/recoverUserCode.php',
                //usando GET because string has special characters
                type: 'POST',
                // Form data
                //datos del formulario
                //data: formData,
                data: obj,
                //mientras enviamos el archivo
                beforeSend: function() {
                    //showMessageUsers("Guardando");
                },
                //una vez finalizado correctamente
                success: function(data) {
                    if(data === "NOCODEEXIST"){
                        if (typeof recoverCodeOkFunc !== "undefined") {
                            recoverCodeOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["NOCODEEXIST"][lanTemp];
                            }else{
                                alert(rots["NOCODEEXIST"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if(data==="CODEWASASKPENDING"){
                        if (typeof recoverCodeOkFunc !== "undefined") {
                            recoverCodeOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["CODEWASASKPENDING"][lanTemp];
                            }else{
                                alert(rots["CODEWASASKPENDING"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if (data === "CODEWASASK") {
                        if (typeof recoverCodeOkFunc !== "undefined") {
                            recoverCodeOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["CODEWASASK"][lanTemp];
                            }else{
                                alert(rots["CODEWASASK"][lanTemp]+" ( Default message )");
                            }

                        }
                    }
                },
                //si ha ocurrido un error
                error: function() {
                    if (typeof regErrorFunc !== "undefined") {
                            regErrorFunc();
                        } else {
                    if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGERROR"][lanTemp];
                            }else{
                                alert(rots["REGERROR"][lanTemp]+" ( Default message )");
                            }
                        }
                }
            });
    }else{
        if (typeof recoverCodeNokFunc !== "undefined") {
            recoverCodeNokFunc(wrongData);
        } else {
            if (document.getElementById("status")) {
                document.getElementById("status").innerHTML = message;
            } else {
                alert(message + " ( Default message )");
            }
        }
    }
}
recoverPwd=function(_dataPwd,recoverOkFunc,recoverWhileFunc,recoverNokFunc,regErrorFunc){
    if (typeof recoverWhileFunc !== "undefined") {
                            recoverWhileFunc();
                        } 
    var message="";
    var obj = {};
    obj.EMAIL = trim(_dataPwd.email);
    obj.CODE=_dataPwd.CODE;
    obj.BLOCNAME=_dataPwd.logo;
    obj.MESSAGE=_dataPwd.MESSAGE;
    obj.MESSAGEPENDING=_dataPwd.MESSAGEPENDING;
    obj.REPLY=_dataPwd.REPLY;
    if(document.getElementById("status")){
        document.getElementById("status").innerHTML="";
    }
    
    var dataRegOK=true;
    var wrongData;
    
    dataRegOK=validarEmail(obj.EMAIL);
    
    if(!dataRegOK){
        message=rots["REGEMAILNOK"][lanTemp];
        wrongData="REGEMAILNOK";
    }
    
    if ( obj.CODE == null || obj.CODE.length == 0 || /^\s*$/.test(obj.CODE) || obj.EMAIL == null || obj.EMAIL.length == 0 || /^\s*$/.test(obj.EMAIL)
    ){   
         dataRegOK=false;
         message=rots["REGNOEMPTY"][lanTemp];
         wrongData="REGNOEMPTY";
    }
    
    if(dataRegOK){
            $.ajax({
                url: './admin/controller/environment/multipleUser/recoverUserPwd.php',
                //usando GET because string has special characters
                type: 'POST',
                // Form data
                //datos del formulario
                //data: formData,
                data: obj,
                //mientras enviamos el archivo
                beforeSend: function() {
                    //showMessageUsers("Guardando");
                },
                //una vez finalizado correctamente
                success: function(data) {
                    if(data === "NOPWDEXIST"){
                        if (typeof recoverOkFunc !== "undefined") {
                            recoverOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["NOPWDEXIST"][lanTemp];
                            }else{
                                alert(rots["NOPWDEXIST"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if(data==="PWDWASASKCODEWRONG"){
                        if (typeof recoverOkFunc !== "undefined") {
                            recoverOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["PWDWASASKCODEWRONG"][lanTemp];
                            }else{
                                alert(rots["PWDWASASKCODEWRONG"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if(data==="PWDWASASKPENDING"){
                        if (typeof recoverOkFunc !== "undefined") {
                            recoverOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["PWDWASASKPENDING"][lanTemp];
                            }else{
                                alert(rots["PWDWASASKPENDING"][lanTemp]+" ( Default message )");
                            }

                        }
                    }else if (data === "PWDWASASK") {
                        if (typeof recoverOkFunc !== "undefined") {
                            recoverOkFunc(data);
                        } else {
                            if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["PWDWASASK"][lanTemp];
                            }else{
                                alert(rots["PWDWASASK"][lanTemp]+" ( Default message )");
                            }

                        }
                    }
                },
                //si ha ocurrido un error
                error: function() {
                    if (typeof regErrorFunc !== "undefined") {
                            regErrorFunc();
                        } else {
                    if (document.getElementById("status")) {
                                document.getElementById("status").innerHTML = rots["REGERROR"][lanTemp];
                            }else{
                                alert(rots["REGERROR"][lanTemp]+" ( Default message )");
                            }
                        }
                }
            });
    }else{
        if (typeof recoverNokFunc !== "undefined") {
            recoverNokFunc(wrongData);
        } else {
            if (document.getElementById("status")) {
                document.getElementById("status").innerHTML = message;
            } else {
                alert(message + " ( Default message )");
            }
        }
    }
}




var shareURL=null;
share=function(type){
    var refresh=new Date().getTime();
    document.getElementById("targetFB").setAttribute("href",shareURL+"?refresh="+refresh);
    switch (type) {
        case 0:
            break;
        default:
            break;
    }
}

var lanFunc=null;
var lanEnv=document.URL.split("/");
var lanTemp= lanEnv[lanEnv.length-2];
if(lanTemp.length>2){
    lanTemp="es";
}

var rotLan=null;




http://www.customicondesign.com/free-icons/flag-icon-set/country-flag-icon-set-for-iphone-map/


changedLan=function(_lan){
    document.getElementById("lanPB").innerHTML=rots["language"][_lan];
    document.getElementById("privatePB").innerHTML=rots["private"][_lan];
    document.getElementById("fixPB").innerHTML=rots["fix"][_lan];
}
var languages=null;
var rots=null;
selLan=function(){
    if(document.getElementById("lanDiv")){
        
    }else{
    var lanDiv=document.createElement("div");
    toClose=lanDiv;
    lanDiv.id="lanDiv";
    lanDiv.className="lanDiv generic_trans";
    document.body.appendChild(lanDiv);
    lanDiv.onclick=function(){ closeDiv(lanDiv) };
     var usersList = "";
     
     
     var lanList="";
     for( var j in languages){
         lanList+="<li id='lanDivItem_"+j+"' style='text-align:center' ><div class='lanStyle' onclick='goLan(\""+j+"\");'>"+languages[j]["rot_"+lanTemp]+"</div></li>";
         
     }
     
     var logoDup=document.getElementsByClassName("logo")[0].innerHTML;
     
     usersList = '<div id="lanDivContainer" >\
                            <div>\
                            <ul>\
                                <li id="logoLanDiv">'+logoDup+'</li>\
                                <li id="rotLanDiv">'+rotLan[lanTemp]+'</li>\
                                '+lanList+'\
                            </ul>\
                            <div class="messages"></div><br /><br />\
                            <div class="showImage"></div>\
                            </div></div>';
   
    
    
    
    lanDiv.innerHTML = usersList;
    if(lanFunc){
        lanFunc();
    }else{
        setTimeout(function() {
            toClose.style.left = "0%";
            endTrans = function() {
                endTrans = null;
            }
        }, 10);
    }
    }
    
}
closeDiv = function(div) {
    div.style.overflow = "hidden";
    div.style.left = "-100%";
    endTrans = function() {
        document.body.removeChild(div);
        lastHTML=null;
        endTrans = null;
    };
};
goLan=function(_lan){
    if(lanTemp===_lan){
        closeDiv(lanDiv);
    }else{
        if (_lan !== "es") {
            window.location = "./"+languages[_lan].url;
        } else {
            window.location = "../";
        }
    }
        
}

var bridgeDiv = null;
goBridge = function() {
   
    if(document.getElementById("bridgeDiv")){
        
    }else{
        bridgeDiv = document.createElement("div");
        bridgeDiv.id = "bridgeDiv";
        bridgeDiv.className = "bridgeDiv generic_trans";
        document.body.appendChild(bridgeDiv);
        bridgeDiv.onclick = function() {
            bridgeDiv.style.overflow = "hidden";
            bridgeDiv.style.left = "-100%";
            endTrans = function() {
                document.body.removeChild(bridgeDiv);
                bridgeDiv=null;
                lastHTML = null;
                endTrans = null;
            };
        };
        var bridgeDivContainer = document.createElement("div");
        bridgeDivContainer.id = "bridgeDivContainer";
        bridgeDiv.appendChild(bridgeDivContainer);
        var bridgeDivInner = document.createElement("div");
        bridgeDivInner.id = "bridgeDivInner";
        bridgeDivInner.onclick = function(event) {
            if (event.stopPropagation) {
                event.stopPropagation();   // W3C model
            } else {
                event.cancelBubble = true; // IE model
            }
        }
        bridgeDivContainer.appendChild(bridgeDivInner);
        $("#bridgeDivInner").load("pages/bridgeCode.html", function() {
            document.getElementById("logoBridgeDiv").innerHTML=document.getElementsByClassName("logo")[0].innerHTML;
            document.getElementById("rotBridgeDiv").innerHTML=bridgeRots["bridgeLoginRot"][lanTemp];
            document.getElementById("bridgePB").innerHTML=bridgeRots["PB"][lanTemp];
            document.getElementById("bridgePBClose").innerHTML=bridgeRots["closePB"][lanTemp];
            
                setTimeout(function() {
                    bridgeDiv.style.left = "0%";
                    endTrans = function() {
                        endTrans = null;
                    }
                }, 10);

        });
}
}

var importDiv = null;
goImport = function(_ori) {
   
    if(document.getElementById("importDiv")){
        
    }else{
        importDiv = document.createElement("div");
        importDiv.id = "importDiv";
        importDiv.className = "importDiv generic_trans";
        document.body.appendChild(importDiv);
    }
        
        importDiv.onclick = function() {
            
            if(importing){
              openImport(null);
            }
            importDiv.style.overflow = "hidden";
            importDiv.style.left = "-100%";
            endTrans = function() {
                document.body.removeChild(importDiv);
                importDiv=null;
                lastHTML = null;
                endTrans = null;
            };
        };
        var importDivContainer = document.createElement("div");
        importDivContainer.id = "importDivContainer";
        importDiv.appendChild(importDivContainer);
        var importDivInner = document.createElement("div");
        importDivInner.id = "importDivInner";
        importDivInner.onclick = function(event) {
            if (event.stopPropagation) {
                event.stopPropagation();   // W3C model
            } else {
                event.cancelBubble = true; // IE model
            }
        }
        importDivContainer.appendChild(importDivInner);
        $("#importDivInner").load("pages/importCode.html", function() {
            document.getElementById("oriImportDiv").innerHTML=_ori;
            document.getElementById("logoImportDiv").innerHTML=document.getElementsByClassName("logo")[0].innerHTML;
            document.getElementById("rotImportDiv").innerHTML=importRots["importLoginRot"][lanTemp];
            document.getElementById("importPB").innerHTML=importRots["PB"][lanTemp];
            document.getElementById("importPBClose").innerHTML=importRots["closePB"][lanTemp];
            
                setTimeout(function() {
                    importDiv.style.left = "0%";
                    endTrans = function() {
                        endTrans = null;
                    }
                }, 10);

        });

}

var editFunc = null;
goEdit = function() {
   
    if(document.getElementById("editDiv")){
        
    }else{
        
 
        var editDiv = document.createElement("div");
        editDiv.id = "editDiv";
        editDiv.className = "editDiv generic_trans";
        document.body.appendChild(editDiv);
        editDiv.onclick = function() {
            editDiv.style.overflow = "hidden";
            editDiv.style.left = "-100%";
            endTrans = function() {
                document.body.removeChild(editDiv);
                editDiv=null;
                lastHTML = null;
                endTrans = null;
            };   
        };
        var editDivContainer = document.createElement("div");
        editDivContainer.id = "editDivContainer";
        editDiv.appendChild(editDivContainer);
        var editDivInner = document.createElement("div");
        editDivInner.id = "editDivInner";
        editDivInner.onclick = function(event) {
            if (event.stopPropagation) {
                event.stopPropagation();   // W3C model
            } else {
                event.cancelBubble = true; // IE model
            }
        }
        editDivContainer.appendChild(editDivInner);
        $("#editDivInner").load("pages/editLogin.html", function() {
            document.getElementById("logoEditorDiv").innerHTML=document.getElementsByClassName("logo")[0].innerHTML;
            document.getElementById("rotEditorDiv").innerHTML=rots["editorLogin"][lanTemp];
            if (editFunc) {
                editFunc();
            } else {
                setTimeout(function() {
                    editDiv.style.left = "0%";
                    endTrans = function() {
                        endTrans = null;
                    }
                }, 10);
            }

        });
}
    


}

var editorLogged=null;
editorLogin=function(){
    var obj={};
        obj.user=document.getElementById("userEditor").value;
        obj.pwd=document.getElementById("passwordEditor").value;
        obj.from=true;
        $.ajax({
            url: CONFIG["adminFolder"]+'/controller/enter.php',
            type: 'POST',
            data: obj,
            //mientras enviamos el archivo
            beforeSend: function () {
            },
            //una vez finalizado correctamente
            success: function (data) {
                    if(data=="OK"){
                        editorLogged={};
                        editorLogged.user=obj.user;
                        editorLogged.pwd=obj.pwd;
                         document.body.removeChild(document.getElementById("editDiv"));
                         window.open("admin/indexAdmin.php","_blank");
                    }else{
                        if(error){
                            error();
                        }
                        editorLogged=null;
                        
                    }
                    
            },
            //si ha ocurrido un error
            error: function () {
            }
        });
}

var applyStyles=function(){
   
    
}


//style collection
/*function style_collection(){
    var self = this;
    self.tabs = ko.observableArray();
    self.ini = function(tabs) {
        sectionGroup=tabs;
        var refresh=new Date().getTime();
        $.getJSON("../css/css1.cc"+refresh, function(data) {
        }).complete(function(data) {
            alert(data);
            //self.tabs(data.responseJSON.items);
        })
    };
}*/
 
function applyFonts(){
    var refresh = new Date().getTime();
    $.getJSON("./controller/environment/json/fonts.json?"+refresh, function(data) {
        }).complete(function(data) {
            self.count=data.responseJSON.items.length;
            var arrayFontsGoogle=new Array();
            for(var j in data.responseJSON.items){
                /*var link = document.createElement('link');
                link.setAttribute("type","text/css")
                link.rel = 'stylesheet';
                link.href = data.responseJSON.items[j].content;
                document.head.appendChild(link);*/
                arrayFontsGoogle.push(data.responseJSON.items[j].content);
                 
                }
                WebFontConfig = {
                    google: { families: arrayFontsGoogle  }
                  };
                  (function() {
                    var wf = document.createElement('script');
                    wf.src = ('https:' == document.location.protocol ? 'https' : 'http') +
                      '://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js?'+refresh;
                    wf.type = 'text/javascript';
                    wf.async = 'true';
                    var s = document.getElementsByTagName('script')[0];
                    s.parentNode.insertBefore(wf, s);
                  })();
        })
}var req; // global variable to hold request object
function loadXMLDoc(url, params)
{
  if(window.XMLHttpRequest) {
    try {
      req = new XMLHttpRequest();
    } catch(e) {
      req = false;
    }
  } else if(window.ActiveXObject) {
    try {
      req = new ActiveXObject("Msxml2.XMLHTTP");
    } catch(e) {
      try {
        req = new ActiveXObject("Microsoft.XMLHTTP");
      } catch(e) {
        req = false;
      }
    }
  }
  if(req) {
    req.onreadystatechange = processReqChange;
    req.open("POST", url, true);
    req.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
    req.send(params);
    return true;
  }
}


function getNodeValue(parent, tagName)
{
  var node = parent.getElementsByTagName(tagName)[0];
  return (node && node.firstChild) ? node.firstChild.nodeValue : false;
}
function processReqChange() 
{
  if(req.readyState == 4 && req.status == 200) {
      
   
        var cadenaXML=  req.responseText.replace("/**/","");
       function StringtoXML(text){
                if (window.ActiveXObject){
                  var doc=new ActiveXObject('Microsoft.XMLDOM');
                  doc.async='false';
                  doc.loadXML(text);
                } else {
                  var parser=new DOMParser();
                  var doc=parser.parseFromString(text,'text/xml');
                }
                return doc;
            }
 
	//example of application:
	var doc = StringtoXML(cadenaXML);
       response  = doc;

    var commands = response.getElementsByTagName('command');
    for(var i=0; i < commands.length; i++) {
      method = commands[i].getAttribute('method');
      switch(method) {
         case 'send_mail':
             var message = getNodeValue(commands[i], 'message');
             send_mail(message);
         break;
         case 'stats_saved':
             var message = getNodeValue(commands[i], 'message');
             stats_saved(base64_decode(message));
         break;
         case 'check_login':
             var message = getNodeValue(commands[i], 'message');
             check_login(base64_decode(message));
         break;
         case 'save_page_user':
             var message = getNodeValue(commands[i], 'message');
             save_page_user(base64_decode(message));
         break;
         case 'readMultipleUser':
             var message = getNodeValue(commands[i], 'message');
             read_MultipleUser(base64_decode(message));
         break;
         
         
        /*case 'setvalue':
          var target = getNodeValue(commands[i], 'target');
          var value = getNodeValue(commands[i], 'value');
          if(target && value) {
            document.getElementById(target).value = value;
          }
          break;

        case 'setdefault':
          var target = getNodeValue(commands[i], 'target');
          if(target) {
            document.getElementById(target).value = document.getElementById(target).defaultValue;
          }
          break;

        case 'focus':
          var target = getNodeValue(commands[i], 'target');
          if(target) {
            document.getElementById(target).focus();
          }
          break;

        case 'setcontent':
          var target = getNodeValue(commands[i], 'target');
          var content = getNodeValue(commands[i], 'content');
          if(target && content) {
            document.getElementById(target).innerHTML = content;
          }
          break;

        case 'setstyle':
          var target = getNodeValue(commands[i], 'target');
          var property = getNodeValue(commands[i], 'property');
          var value = getNodeValue(commands[i], 'value');
          if(target && property && value) {
            document.getElementById(target).style[property] = value;
          }
          break;

        case 'setproperty':
          var target = getNodeValue(commands[i], 'target');
          var property = getNodeValue(commands[i], 'property');
          var value = getNodeValue(commands[i], 'value');
          if(value == "true") value = true;
          if(value == "false") value = false;
          if(target) {
            document.getElementById(target)[property] = value;
          }
          break;*/

        default:
          window.console.log("Error: unrecognised method '" + method + "' in processReqChange()");
      }
    }
  }
}
function base64_decode(data) {
  //  discuss at: http://phpjs.org/functions/base64_decode/
  // original by: Tyler Akins (http://rumkin.com)
  // improved by: Thunder.m
  // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
  // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
  //    input by: Aman Gupta
  //    input by: Brett Zamir (http://brett-zamir.me)
  // bugfixed by: Onno Marsman
  // bugfixed by: Pellentesque Malesuada
  // bugfixed by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)
  //   example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==');
  //   returns 1: 'Kevin van Zonneveld'
  //   example 2: base64_decode('YQ===');
  //   returns 2: 'a'

  var b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';
  var o1, o2, o3, h1, h2, h3, h4, bits, i = 0,
    ac = 0,
    dec = '',
    tmp_arr = [];

  if (!data) {
    return data;
  }

  data += '';

  do { // unpack four hexets into three octets using index points in b64
    h1 = b64.indexOf(data.charAt(i++));
    h2 = b64.indexOf(data.charAt(i++));
    h3 = b64.indexOf(data.charAt(i++));
    h4 = b64.indexOf(data.charAt(i++));

    bits = h1 << 18 | h2 << 12 | h3 << 6 | h4;

    o1 = bits >> 16 & 0xff;
    o2 = bits >> 8 & 0xff;
    o3 = bits & 0xff;

    if (h3 == 64) {
      tmp_arr[ac++] = String.fromCharCode(o1);
    } else if (h4 == 64) {
      tmp_arr[ac++] = String.fromCharCode(o1, o2);
    } else {
      tmp_arr[ac++] = String.fromCharCode(o1, o2, o3);
    }
  } while (i < data.length);

  dec = tmp_arr.join('');

  return dec.replace(/\0+$/, '');
}
var buttonPress=null;
function swipedetect(el, callback){
 var touchsurface = el,
 swipedir,
 startX,
 startY,
 distX,
 distY,
 threshold = 150, //required min distance traveled to be considered swipe
 restraint = 100, // maximum distance allowed at the same time in perpendicular direction
 allowedTime = 300, // maximum time allowed to travel that distance
 elapsedTime,
 startTime,
 handleswipe = callback || function(swipedir){}
 
 touchsurface.addEventListener('touchstart', function(e){
     
     if(e.target){
          buttonPress=e.target.id;
     }else{
        buttonPress=null 
     }
  var touchobj = e.changedTouches[0]
  swipedir = 'none'
  dist = 0
  startX = touchobj.pageX
  startY = touchobj.pageY
  startTime = new Date().getTime() // record time when finger first makes contact with surface


 }, false)
 
 touchsurface.addEventListener('touchmove', function(e){
 // prevent scrolling when inside DIV
 }, false)
 
 touchsurface.addEventListener('touchend', function(e){
  var touchobj = e.changedTouches[0]
  distX = touchobj.pageX - startX // get horizontal dist traveled by finger while in contact with surface
  distY = touchobj.pageY - startY // get vertical dist traveled by finger while in contact with surface
  elapsedTime = new Date().getTime() - startTime // get time elapsed
  if (elapsedTime <= allowedTime){ // first condition for awipe met
   if (Math.abs(distX) >= threshold && Math.abs(distY) <= restraint){ // 2nd condition for horizontal swipe met
    swipedir = (distX < 0)? 'left' : 'right' // if dist traveled is negative, it indicates left swipe
   }
   else if (Math.abs(distY) >= threshold && Math.abs(distX) <= restraint){ // 2nd condition for vertical swipe met
    swipedir = (distY < 0)? 'up' : 'down' // if dist traveled is negative, it indicates up swipe
   }
  }
  handleswipe(swipedir)

   
 }, false)
}
 



/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
var jsCollection={};
var execAddJS=function(jsFile,param,root,css){
    if(!jsCollection[jsFile]){
        var headID = document.getElementsByTagName("head")[0];         
        var newScript = document.createElement("script");
       if(css){
            var cssNode = document.createElement('link');
            cssNode.type = 'text/css';
            cssNode.rel = 'stylesheet';
            cssNode.href = css+".css";
            cssNode.media = 'screen';
            headID.appendChild(cssNode);
       }
        newScript.type = "text/javascript";
        newScript.src = "./js/"+root+jsFile+".js";
        headID.appendChild(newScript);
        jsCollection[jsFile]=true;
    }else{
        eval(jsFile)();
    }
}


/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

function getLocationHash() {
    return window.location.hash.substring(1);

}

window.onpopstate = function(e) {
    if (!ini) {
        window.history.pushState(null, tab.content, "?1");
        historyDatePointer = -1;
    } else if (window.location.href.split("?")[1] !== undefined) {
        //this because safari
        historyDatePointer = Number(window.location.href.split("?")[1]);
    } else {
        historyDatePointer = -1;
    }
    if (historyDatePointer !== -1) {
        fromHistory = true;
        if (historyDate[historyDatePointer][0] === "bridge") {
            clipblocBridge(historyDate[historyDatePointer][1]);
        } else {
            if (bridgeDiv) {
                bridgeDiv.click();
            }
            internalNavMenu(historyDate[historyDatePointer][0], historyDate[historyDatePointer][1]);
        }
    } else {
        window.history.pushState(null, tab.content, "");
    }
};

var historyDate = {};
var historyDatePointer = -1;
var fromHistory = false;
var antSection = null;
var iniSection = 0;
var ini = null;
var initalized = false;

var focus = 0;
var sectionTab = 0;
var subSectionTab = 0;
var pageTab = 0;
var transCreate = false;

var tabHome = "";
var tabHomeRot = "";

var pageAd = false;

var topPos = 0;
var menuVPB = null;
var menuPBVisible = true;

var privateAccess = null;
var privateAccess_ori = null;
var resizeFunc = null;
var importFunc = null;
var importEndFunc = null;
var beforeTransitionFunc = null;
var afterTransitionFunc = null;
var transitionEndFunc = null;
var newTransitionFunc = null;

resizeDoc = function() {
    if (resizeFunc) {
        resizeFunc();
    }

    menuResize();
    var mainContent = document.getElementById("date");
    if (!fixed) {
        topPos = document.getElementById("headerContainer").offsetHeight;
        if (lastPage) {
            if (window.innerWidth >= 900) {
                lastPage.className = "page";
                lastPage.style.top = topPos + "px";

            } else {
                lastPage.style.top = topPos + "px";
            }
            document.getElementById("imgHeader").style.height = topPos + "px";
            lastPage.className = "page generic_trans";
        }



    }
    if (typeof resizeSubmenuFunc !== "undefined" && resizeSubmenuFunc !== null) {
        resizeSubmenuFunc();
    } else {
        if (subMenuPB && !submenuAppHide) {
            mainContent.style.width = window.innerWidth - submenuContainer.offsetWidth + "px";
        }
    }
    if (pageAd) {

        if (fixed) {


        } else if (window.innerWidth >= 1280) {
            if (submenuExists) {
                mainContent.style.width = "66.66666667%";
                mainContent.className = "col-xs-8 nopadding generic_trans_basic";
            } else {
                mainContent.style.width = "83.33333333%";
                mainContent.className = "col-xs-10 nopadding generic_trans_basic";

            }
            endTrans = function() {
                endTrans = null;
                document.getElementById("adContainner").style.opacity = 1;
                document.getElementById("adContainner").style.height = "100%";
            };
        } else {
            document.getElementById("adContainner").style.opacity = 0;
            document.getElementById("adContainner").style.height = "0px";
            if (submenuExists) {
                mainContent.style.width = "83.33333333%";
                mainContent.className = "col-xs-10 nopadding generic_trans_basic";
            } else {
                mainContent.style.width = "100%";
                mainContent.className = "col-xs-12 nopadding generic_trans_basic";
            }
            endTrans = function() {
                endTrans = null;
            };

        }
    }
};

window.addEventListener("resize", resizeDoc, false);

function internalNavSection(date) {
    var tabSel = document.getElementById(date);
    admin_core.iniSections.SelSection(tabSel);
}

function sections() {
    var self = this;
    self.tabs = ko.observable();
    self.ini = function() {
        var refresh = new Date().getTime();
        $.getJSON("./controller/environment/json/sections.json?" + refresh, function(data) {
        }).complete(function(data) {
            self.count = data.responseJSON.items.length;
            self.tabs(data.responseJSON.items);
            if (!initalized) {
                //creo
                applyFonts();
                document.getElementById("imgHeader").style.opacity = 1;
                endTrans = function() {
                    //if (!fbId) {
                        ini = document.getElementById("menu_" + data.responseJSON.items[iniSection].date);
                        ini.click();
                        /*historyDatePointer++;
                         if (!fromHistory) {
                         window.history.pushState(null, data.responseJSON.items[iniSection].date, "?" + 1);
                         historyDate[1] = [data.responseJSON.items[iniSection].date, null, new Date().getTime()];
                         } else {
                         fromHistory = false;
                         
                         }*/
                    /*} else {
                        

                    }*/
                    initalized = true;


                };

            }
        });
    };

    self.SelSection = function(tab) {
        //to prevent if the login comes from other clip and not from an enginee
        if (privateAccess) {
            privateAccess_ori = privateAccess;
        }
        privateAccess = function() {


            if (self.internalNavPage) {
                internalNavPage = self.internalNavPage;
                self.internalNavPage = null;
            }
            if (!transCreate) {
                transCreate = true;
                var cont = 0;
                if (!touchSense) {
                    for (var j in self.tabs()) {
                        if (self.tabs()[j] === tab) {
                            if (cont < focus) {
                                moveSense = "RE";
                            } else {
                                moveSense = "AV";
                            }
                            focus = cont;
                            break;
                        }
                        cont++;
                    }
                } else {
                    touchSense = false;
                }
                subSectionTab = 0;
                pageTab = 0;
                sectionTab = focus;
                if (antSection !== null) {
                    if (antSection.indexOf('menu') > -1) {
                        if (document.getElementById(antSection).className === "innerMenu tabSelected") {
                            document.getElementById(antSection).className = "innerMenu";
                        } else {
                            document.getElementById(antSection).className = "innerMenuCollapsed";
                        }

                    } else {
                        if (document.getElementById(antSection)) {
                            document.getElementById(antSection).className = "innerFoot";
                        }

                    }
                }
                antSection = "menu_" + tab.date;
                if (document.getElementById(antSection).className === "innerMenu") {
                    document.getElementById(antSection).className = "innerMenu tabSelected";
                } else {
                    document.getElementById(antSection).className = "innerMenuCollapsed tabSelectedCollapsed";
                }
                createPage("page_menu_" + tab.date, tab.content, tab.submenu, tab.date, tab.tabFb, tab.tabCounter, tab.clipbloc, tab.ad, tab.adCode);
                tabHome = "menu_" + tab.date;
                tabHomeRot = tab.rot;

            }
            if (!fromHistory) {
                historyDatePointer++;
                window.history.pushState(null, tab.content, "?" + historyDatePointer);
                historyDate[historyDatePointer] = [tab.date, null, new Date().getTime()];

            } else {
                fromHistory = false;

            }
        };

        if (bridgeDiv) {
            bridgeDiv.click();
        }
        ;

        if (tab.privated) {
            checkLoggedUserPrivate();
        } else {
            privateAccess();
        }



    };

    self.SelSectionBridge = function(tab, _oriPath, _target, _clip) {
        $.post(_oriPath + "/admin/controller/environment/multipleUser/checkBridge.php", {"target": _target, "clip": _clip}).done(function(data) {
            if (data === "OK") {
                bridgeOpen("*");
            } else if (data === "NOK") {
                if (typeof noBridgeFunc !== "undefined" && noBridgeFunc) {
                    noBridgeFunc();
                } else {
                    defaultNoBridge();
                }
            } else {
                showBridgeLogin(_oriPath, _target, _clip);
            }

        }).fail(function() {
            alert("error");
        });

        bridgeOpen = function(_code) {

            //to prevent if the login comes from other clip and not from an enginee
            if (self.internalNavPage) {
                internalNavPage = self.internalNavPage;
                self.internalNavPage = null;
            }
            if (privateAccess) {
                privateAccess_ori = privateAccess;
            }
            privateAccess = function() {
                if (self.internalNavPage) {
                    internalNavPage = self.internalNavPage;
                    self.internalNavPage = null;
                }
                if (!transCreate) {
                    transCreate = true;
                    var cont = 0;
                    /*if (!touchSense) {
                     for (var j in self.tabs()) {
                     if (self.tabs()[j] === tab) {
                     if (cont < focus) {
                     moveSense = "RE";
                     } else {
                     moveSense = "AV";
                     }
                     focus = cont;
                     break;
                     }
                     cont++;
                     }
                     } else {
                     touchSense = false;
                     }*/
                    focus = -1;
                    moveSense = "AV";
                    subSectionTab = 0;
                    pageTab = 0;
                    sectionTab = focus;

                    if (antSection && antSection.indexOf('menu') > -1) {
                        if (document.getElementById(antSection).className === "innerMenu tabSelected") {
                            document.getElementById(antSection).className = "innerMenu";
                        } else {
                            document.getElementById(antSection).className = "innerMenuCollapsed";
                        }

                    } else {
                        if (antSection && document.getElementById(antSection)) {
                            document.getElementById(antSection).className = "innerFoot";
                        }

                    }

                    antSection = null;
                    /*if (document.getElementById(antSection).className == "innerMenu") {
                     document.getElementById(antSection).className = "innerMenu tabSelected";
                     } else {
                     document.getElementById(antSection).className = "innerMenuCollapsed tabSelectedCollapsed";
                     }*/
                    createPageBridge(_code, _oriPath, _clip, _target, "page_menu_" + tab.date, tab.content, tab.submenu, tab.date, tab.tabFb, tab.tabCounter, tab.clipbloc, tab.ad, tab.adCode);

                }
                if (!fromHistory) {
                    historyDatePointer++;
                    window.history.pushState(null, tab.content, "?" + historyDatePointer);
                    historyDate[historyDatePointer] = ["bridge", _oriPath + "::" + _target + "::" + _clip, null, new Date().getTime()];
                } else {
                    fromHistory = false;

                }
            };

            if (tab.privated) {
                checkLoggedUserPrivate();
            } else {
                privateAccess();
            }

        };

    };
    self.SelSectionImport = function(_oriPath, _target, _clip) {

        $.post(_oriPath + "/admin/controller/environment/multipleUser/checkImport.php", {"target": _target, "clip": _clip}).done(function(data) {
            if (data.indexOf("OK") >= 0) {
                openImport("*");
            } else if (data.indexOf("NOK") >= 0) {
                if (typeof noImportFunc !== "undefined" && noImportFunc) {
                    noImportFunc();
                } else {
                    defaultNoImport();
                }
            } else {
                showImportLogin(_oriPath, _target, _clip);
            }

        }).fail(function() {
            alert("error");
        });
        openImport = function(_code) {
            createPageImport(_code, _oriPath, _clip, _target);
        };



    };

    self.SelSectionImportSubPage = function(_oriPath, _target, _clip, _name, _page, _container, _clipbloc, _fb, _counterVisible) {
        $.post(_oriPath + "/admin/controller/environment/multipleUser/checkImport.php", {"target": _target, "clip": _clip}).done(function(data) {
            if (data.indexOf("OK") >= 0) {
                openImport("*");
            } else if (data.indexOf("NOK") >= 0) {
                if (typeof noImportFunc !== "undefined" && noImportFunc) {
                    noImportFunc();
                } else {
                    defaultNoImport();
                }
            } else {
                showImportLogin(_oriPath, _target, _clip, _container);
            }

        }).fail(function() {
            alert("error");
        });
        openImport = function(_code) {
            createSubPageImport(_code, _oriPath, _clip, _target, _name, _page, _container, _clipbloc, _fb, _counterVisible);
        };

    };

    self.count = 0;

    self.internalNav = function(_dateMenu, _datePage) {
        if (document.getElementById("foot_" + _dateMenu)) {
            var tabSel = document.getElementById("foot_" + _dateMenu);
        } else {
            tabSel = document.getElementById("menu_" + _dateMenu);
        }
        //var tabSel = document.getElementById("foot_" + _dateMenu);
        self.internalNavPage = _datePage;
        tabSel.click();

    };

    self.internalNavPage = null;
    self.SelNextSection = function(tab) {
        self.SelSection(self.tabs()[focus]);
    };

    self.SelBeforeSection = function(tab) {
        self.SelSection(self.tabs()[focus]);
    };
}
var auxFunc = null;
function foot() {
    var self = this;
    self.tabs = ko.observable();
    self.ini = function() {
        var refresh = new Date().getTime();
        $.getJSON("./controller/environment/json/footer.json?" + refresh, function(data) {
        }).complete(function(data) {
            self.count = data.responseJSON.items.length;
            self.tabs(data.responseJSON.items);

        });

    };
    self.SelFoot = function(tab) {
        //to prevent if the login comes from other clip and not from an enginee
        if (privateAccess) {
            privateAccess_ori = privateAccess;
        }
        privateAccess = function() {


            if (self.internalNavPage) {
                internalNavPage = self.internalNavPage;
                self.internalNavPage = null;
            }
            if (!transCreate) {
                transCreate = true;
                var cont = 0;
                if (!touchSense) {
                    for (var j in self.tabs()) {
                        if (self.tabs()[j] === tab) {
                            if (cont < focus) {
                                moveSense = "RE";
                            } else {
                                moveSense = "AV";
                            }
                            focus = cont;
                            break;
                        }
                        cont++;
                    }
                } else {
                    touchSense = false;
                }
                subSectionTab = 0;
                pageTab = 0;
                sectionTab = focus;
                if (antSection !== null) {
                    if (antSection.indexOf('menu') > -1) {
                        if (document.getElementById(antSection).className === "innerMenu tabSelected") {
                            document.getElementById(antSection).className = "innerMenu";
                        } else {
                            document.getElementById(antSection).className = "innerMenuCollapsed";
                        }

                    } else {
                        if (document.getElementById(antSection)) {
                            document.getElementById(antSection).className = "innerFoot";
                        }

                    }
                }
                antSection = "foot_" + tab.date;
                if (document.getElementById(antSection).className === "innerFoot") {
                    document.getElementById(antSection).className = "innerFoot tabSelected";
                } else {
                    document.getElementById(antSection).className = "innerMenuCollapsed tabSelectedCollapsed";
                }
                createPage("page_foot_" + tab.date, tab.content, tab.submenu, tab.date, tab.tabFb, tab.tabCounter, tab.clipbloc, tab.ad, tab.adCode);
                tabHome = "foot_" + tab.date;
                tabHomeRot = tab.rot;

            }
            if (!fromHistory) {
                historyDatePointer++;
                window.history.pushState(null, tab.content, "?" + historyDatePointer);
                historyDate[historyDatePointer] = [tab.date, null, new Date().getTime()];
            } else {
                fromHistory = false;

            }
        };

        if (tab.privated) {
            checkLoggedUserPrivate();
        } else {
            privateAccess();
        }

    };
    self.count = 0;
    self.internalNav = function(_date, _datePage) {
        if (document.getElementById("foot_" + _date)) {
            var tabSel = document.getElementById("foot_" + _date);
        } else {
            tabSel = document.getElementById("menu_" + _date);
        }
        self.internalNavPage = _datePage;
        tabSel.click();
    };

    self.internalNavPage = null;
    self.SelNextSection = function(tab) {
        self.SelSection(self.tabs()[focus]);
    };

    self.SelBeforeSection = function(tab) {
        self.SelSection(self.tabs()[focus]);
    };

}
;

var touchSense = false;
var goSection = null;
var internalNavMenu = null;
var internalNavFoot = null;
var internalNavPage = null;
var iniSections = null;

var admin_core = function() {
    if (userData.user) {
        logged = true;
        userLogged.user = userData.user;
        userLogged.pwd = userData.pwd;
        userLogged.name = userData.name;
    }
    if (!languages) {
        eval('languages=' + CONFIG["languages"]);
    }
    if (!rots) {
        eval('rots=' + CONFIG["rots"]);
    }
    if (!rotLan) {
        eval('rotLan=' + CONFIG["rotLan"]);
    }
    if (typeof bridgeRots === "undefined") {
        eval('bridgeRots=' + CONFIG["bridgeRots"]);
    }
    if (typeof importRots === "undefined") {
        eval('importRots=' + CONFIG["importRots"]);
    }
    var logoOri = document.getElementsByClassName("logo")[0];
    if (typeof CONFIG["logo"] !== "undefined") {
        logoOri.innerHTML = CONFIG["logo"];
    } else {
        logoOri.innerHTML = "Bloc";
    }

    changedLan(lanTemp);
    applyStyles();
    iniSections = new sections;
    var iniFooter = new foot;
    goSection = function(_focus) {
        focus = _focus;
        iniSections.SelNextSection();
    };

    internalNavMenu = function(_menu, _page) {
        iniSections.internalNav(_menu, _page);
    };

    internalNavFoot = function(_footer, _page) {
        iniFooter.internalNav(_footer, _page);
    };

    leftFunction = function() {
        touchSense = true;
        moveSense = "AV";
        focus++;
        if (focus > iniSections.tabs().length - 1) {
            focus = 0;
        }
        iniSections.SelNextSection();
    };

    rightFunction = function() {
        touchSense = true;
        moveSense = "RE";
        focus--;
        if (focus < 0) {
            focus = iniSections.tabs().length - 1;
        }
        iniSections.SelBeforeSection();
    };

    ko.applyBindings(iniSections, document.getElementById("menu"));
    ko.applyBindings(iniFooter, document.getElementById("footer"));
    iniSections.ini();
    iniFooter.ini();
    iniLogin();

    /*var fixImgClip = document.createElement("div");
     fixImgClip.style.zIndex = 10000;
     fixImgClip.style.position = "fixed";
     fixImgClip.style.bottom = "5px";
     fixImgClip.style.right = "5px";
     fixImgClip.style.background = "rgba(0,0,0,.5)";
     //fixImgClip.style.background="#666";
     fixImgClip.style.padding = "3px";
     fixImgClip.style.borderRadius = "6px";
     fixImgClip.style.cursor = "pointer";
     fixImgClip.onclick = goToClip;
     fixImgClip.innerHTML = '<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAuRJREFUeNqslztoVEEUhrNiQDdrRDDiGl0fIGhnI1aKjWKwC4L4Ai3UmMRGOx8h2ahZUtpa2QlaKGpjYkIenWA22fhA7ERRUAJqQNG913/gXzg5nrm7d/cOfCQzOzPnzPxzzsxNhWHYlFBZB46CTpAFzWARlMBdMAL+N+YcSICT4F3oL3/BE7BTj03C+K2w9vIJ7E/SgYIy8BEMg8NgHzgF7nMHpBM7knBAr3wEbOJvW8AusIb1TrAg+jo5ljfiQF4ZHwcZsAE8Aj/Bb/CZfd2YY2In3N+99TqgVz4K0mAjKHm0v8qxT0VboR4HtObPQAvYDObVqf8AAta/gFZwRvR5HNcBa+UZGp9Txs+BLJ0I6YgLwQOi32QcB7Tmz4XmRWW8m2OcE7/Yvsi+R9ShrcmBfuO0r6TmcuVlGnVjzrNeKQ/Zflu03anFgX5Dc3fgcsaB6+KYbmV8BrSBreCbaD9ezYE+ZWACrPJo3ssxvSrpzDI3uHFTov19JUf4jF9Rxqc5QGteFppfUGPmaDxD2WQ5EZUJ9conGULtatvL1Lpy4MrKeDvlGlXz5aPuggFj21uNOA+E5j3K+Euwnts+ruYbiLoNr6vOU9z2nKF5j9BcGi8KzcfUfIOW3JV/Bj2aZ3mQrDjXms9GaD7kO+xWlpuI0PysJ85LPKBpJilZbkaFutbfGV9txHnAFVuazzMpWZrnqyU6WUmBZm6jT3Nt/DXYxm2PtXJfFGjNdZwH4rc3zG5pQ/NCrZecrCwDDzxx3mWsPMc7Qa/8RpwrXlb2gD9C84ueUCvReMYItXzM98USBy6p69a17VYGXnHb69Y8ygH52hlm2wqRmt/ysdnSiOZRDlwTE95THd0B3E7jY41oHuXAITHpd9ChOq+tJ87jOOB0fSEmX+BrtoOPyWISmlfLA+6t/kMZCoxn9lBC35Tme+AgD5xVnHOXkzLuSHk+z93n9Wl+areBr2Can9kzTQmWfwIMAGAVyv+O8QDeAAAAAElFTkSuQmCC" />';
     document.body.appendChild(fixImgClip);*/
};

goToClip = function() {
    window.location.assign("http://clipbloc.com");
};

var initialized = function() {
    ini.click();
};

var lastPage = null;
var endTransPage = null;

var moveSense = "AV";
var submenuExists = false;
var adExists = false;
var createPage = function(name, content, submenu, date, fb, counterVisible, clipbloc, ad, adCode) {
    contentClean = null;
    pageAd = ad;
    transCreate = true;
    document.body.onmousemove = null;
    if (lastPage === null) {
        var page = document.createElement("div");
        page.className = "page generic_trans";
        page.id = name;
        page.style.top = topPos + "px";
        page.style.left = "100%";
        //page.style.height = "100%";
        //page.style.paddingBottom = document.getElementById("footer").offsetHeight + "px";
        document.body.appendChild(page);
        $("#" + name).load("controller/proxy.php?url=../pages/" + content + ".html", function() {
            //$("#" + name).load("./pages/" + content + ".html", function() {

            var refresh = new Date().getTime();
            if (fb) {
                var urlToShareArray=document.URL.split("?");
                urlToShareArray.pop();
                var urlToShare=urlToShareArray.join("/");
                //var fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/"+pageTab+"&refresh="+refresh;
                var fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
                shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
                document.getElementById("targetFB").setAttribute("href", fbSharer);
            } else if (!fb || fb === "undefined") {
                document.getElementById("socialfb").style.display = "none";
            }
            if (counterVisible) {
                document.getElementById("clipblocCount").style.display = "block";
            } else if (!counterVisible || counterVisible === "undefined") {
                document.getElementById("clipblocCount").style.display = "none";
            }
            if (submenu !== null && submenu !== "") {
                submenuExists = true;
                var submenuClass = new menu_level_2();

                //document.body.appendChild(submenuContainer);
                ko.applyBindings(submenuClass, document.getElementById("menu_level_2"));
                submenuClass.ini(submenu);
                document.getElementById("homeSection").innerHTML = tabHomeRot;
            } else {
                submenuExists = false;
                document.getElementById("submenuContainer").style.display = "none";
                if (subMenuPB) {
                    document.body.removeChild(subMenuPB);
                    subMenuPB = null;
                }
                document.getElementById("menu_level_2").parentNode.style.display = "none";
                document.getElementById("date").className = "col-xs-12 nopadding";
            }
            $("#date").load("controller/proxy.php?url=../pages/" + date + ".html", function() {
                //$("#date").load("./pages/" + date + ".html?" + refresh, function() {
                if (ad) {
                    if (submenu !== null && submenu !== "") {
                        document.getElementById("date").className = "col-xs-8 nopadding";

                    } else {
                        document.getElementById("date").className = "col-xs-10 nopadding";
                    }
                    createAdv(date, adCode);
                }
                record_stats(date);
                var contentHTML = document.getElementById("date").innerHTML;
                if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) || (clipbloc !== undefined && clipbloc !== "")) {
                    
                    if ((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) {
                        var newPage = contentHTML.split("::");
                        var toNewPage = "../pages/" + newPage[2] + ".html";
                    } else {
                        toNewPage = "./editor/rmt/" + clipbloc + "/clipbloc.html";
                    }
                    if (submenu !== null && submenu !== "") {
                        submenuExists = true;
                    } else {
                        submenuExists = false;
                    }
                    if (importFunc) {
                        importFunc(newPage[1], newPage[2], newPage[3]);
                    }
                    clipblocImport(newPage[1] + "::" + newPage[2] + "::" + newPage[3]);
                } else {
                    keepFromImport=false;
                    setTimeout(function() {
                        transitionEndFunc = function() {
                            page.style.left = "0px";
                            endTrans = function() {
                                menuHorizontal = document.getElementById("menuHorizontal");
                                menuHorizontal.style.visibility = "visible";
                                document.getElementById("fixPB").style.visibility = "visible";
                                document.getElementById("privatePB").style.visibility = "visible";
                                document.getElementById("lanPB").style.visibility = "visible";
                                endTrans = null;
                                lastPage = page;
                                lastPage.addEventListener("transitionend", function(e) {
                                    if (endTransPage !== null) {
                                        endTransPage();
                                    }
                                }, false);
                                lastPage.addEventListener('webkitTransitionEnd', function() {
                                    // the same above
                                    if (endTransPage !== null) {
                                        endTransPage();
                                    }
                                });
                                transCreate = false;
                                if (!collapsed) {
                                    collapseMenu();
                                }
                                resizeDoc();

                                if (afterTransitionFunc) {
                                    afterTransitionFunc();
                                }
                                if(fbId){
                                    var newURL = "";
                                    var url = document.URL.split("/");
                                    for (j = 0; j < url.length - 1; j++) {
                                        newURL += url[j] + "/";
                                    }
                                    
                                    window.history.pushState({}, 'bar', newURL);
                                    internalNavMenu(fbId);
                                    //createPage("page_menu_" + fbId, "basic", null, fbId, true, true);
                                    tabHome = "menu_" + fbId;
                                    tabHomeRot = "";
                                }


                            };
                        };
                        if (beforeTransitionFunc) {
                            beforeTransitionFunc(transitionEndFunc);
                        } else {
                            transitionEndFunc();
                        }

                    }, 10);
                }
            });

        });
    } else if (name === lastPage.id && originalSubPage === "") {
        transCreate = false;
        if (internalNavPage) {
            var pageSel = document.getElementById("page_" + internalNavPage);
            pageSel.click();
        }
    } else if (name === lastPage.id && originalSubPage !== "") {
        record_stats(date);
        transCreate = false;
        if (lastSubPage) {
            lastSubPage.className = "innerSubmenu";
            lastSubPage = null;
        }
        if (internalNavPage) {
            var pageSel = document.getElementById("page_" + internalNavPage);
            pageSel.click();

        } else {
            var container = document.getElementById("date");
            container.style.opacity = "0";
            endTrans =function(){
                endTrans = null;
           
                $("#date").load("controller/proxy.php?url=../pages/" + date + ".html", function() {
                    transitionEndFunc = function() {
                        
                            //container.innerHTML = originalSubPage;
                            var refresh = new Date().getTime();
                            if (fb) {
                                document.getElementById("socialfb").style.display = "block";
                                //fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/0&refresh="+refresh;
                                var urlToShareArray=document.URL.split("?");
                                urlToShareArray.pop();
                                var urlToShare=urlToShareArray.join("/");

                                fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
                                document.getElementById("targetFB").setAttribute("href", fbSharer);
                                shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
                            } else if (!fb || fb === "undefined") {
                                document.getElementById("socialfb").style.display = "none";
                            }
                            if (counterVisible) {
                                document.getElementById("clipblocCount").style.display = "block";
                            } else if (!counterVisible || counterVisible === "undefined") {
                                document.getElementById("clipblocCount").style.display = "none";
                            }
                            originalSubPage = "";
                          
                            container.style.opacity = "1";

                            endTrans = function() {
                                if (ad) {
                                    document.getElementById("adContainner").style.opacity = 1;
                                }
                                endTrans = null;
                                if (submenu !== null && submenu !== "") {
                                    submenuExists = true;

                                } else {
                                    submenuExists = false;

                                }
                                transCreate = false;
                                if (!collapsed) {
                                    collapseMenu();
                                }
                                if (afterTransitionFunc) {
                                    afterTransitionFunc();
                                }
                                if (typeof CONFIG !== "undefined" && typeof CONFIG["closeSubMenuOnSelect"] !== "undefined" && CONFIG["closeSubMenuOnSelect"] === "true") {
                                    hideSubmenuApp();
                                    submenuAppHide = true;
                                }
                            
                        };

                    };
                    if (beforeTransitionFunc) {
                        beforeTransitionFunc(transitionEndFunc);
                    } else {
                        transitionEndFunc();
                    }
                });
             }

        }


    } else if (name !== lastPage.id || fbId) {
        fbId = null;
        lastSubPage = null;
        originalSubPage = "";
        if (document.getElementById("menu_level_2")) {
            document.getElementById("mainContainer").id = "mainContainer_old";
            document.getElementById("submenuContainer").id = "submenuContainer_old";
            document.getElementById("menu_level_2").id = "old";
            document.getElementById("date").id = "date_old";
            document.getElementById("targetFB").id = "targetFB_old";
            if (document.getElementById("homeSection")) {
                document.getElementById("homeSection").id = "homeSection_old";
            }
            if (document.getElementById("socialfb")) {
                document.getElementById("socialfb").id = "socialfb_old";
            }
            if (document.getElementById("counter")) {
                document.getElementById("counter").id = "counter_old";
            }
            if (document.getElementById("clipblocCount")) {
                document.getElementById("clipblocCount").id = "clipblocCount_old";
            }
            if (document.getElementById("adContainner")) {
                document.getElementById("adContainner").id = "adContainner_old";
                document.getElementById("adContentContainner").id = "adContentContainner_old";
            }

        }
        var page = document.createElement("div");
        page.className = "page generic_trans";
        page.id = name;
        if (fixed) {
            page.style.top = "0";
        } else {
            page.style.top = topPos + "px";
        }

        //page.style.paddingBottom = document.getElementById("footer").offsetHeight + "px";
        if (lastPage && moveSense === "RE") {
            page.style.left = "-100%";
        } else {
            page.style.left = "100%";
        }
        pageImport = page;
        document.body.appendChild(page);
        $("#" + name).load("controller/proxy.php?url=../pages/" + content + ".html", function() {
            //$("#" + name).load("./pages/" + content + ".html", function() {

            var refresh = new Date().getTime();
            if (fb) {
                 var urlToShareArray=document.URL.split("?");
                urlToShareArray.pop();
                var urlToShare=urlToShareArray.join("/");
                //fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/0&refresh="+refresh;
                fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
                shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
                document.getElementById("targetFB").setAttribute("href", fbSharer);
            } else if (!fb || fb === "undefined") {
                document.getElementById("socialfb").style.display = "none";
            }

            if (counterVisible) {
                document.getElementById("clipblocCount").style.display = "block";
            } else if (!counterVisible || counterVisible === "undefined") {
                document.getElementById("clipblocCount").style.display = "none";
            }
            if (submenu !== null && submenu !== "") {
                //document.body.appendChild(submenuContainer);
                submenuExists = true;
                var submenuClass = new menu_level_2();
                ko.applyBindings(submenuClass, document.getElementById("menu_level_2"));
                submenuClass.ini(submenu);
                document.getElementById("homeSection").innerHTML = tabHomeRot;
            } else {

                submenuExists = false;
                document.getElementById("menu_level_2").parentNode.style.display = "none";
                document.getElementById("date").className = "col-xs-12 nopadding";
                document.getElementById("submenuContainer").style.display = "none";
                if (subMenuPB) {
                    document.body.removeChild(subMenuPB);
                    subMenuPB = null;
                }

            }

            $("#date").load("controller/proxy.php?url=../pages/" + date + ".html", function() {
                //$("#date").load("./pages/" + date + ".html?" + refresh, function() {
                if (ad) {
                    if (submenu !== null && submenu !== "") {
                        document.getElementById("date").className = "col-xs-8 nopadding";

                    } else {
                        document.getElementById("date").className = "col-xs-10 nopadding";
                    }
                    createAdv(date, adCode);
                }
                record_stats(date);
                var contentHTML = document.getElementById("date").innerHTML;
                if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) || (clipbloc !== undefined && clipbloc !== "")) {
                    
                    if ((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) {
                        var newPage = contentHTML.split("::");
                        var toNewPage = "../pages/" + newPage[2] + ".html";
                    } else {
                        toNewPage = "./editor/rmt/" + clipbloc + "/clipbloc.html";
                    }
                    var container = document.getElementById("htmlContent");
                    if (submenu !== null && submenu !== "") {
                        submenuExists = true;
                    } else {
                        submenuExists = false;
                    }
                    if (importFunc) {
                        importFunc(newPage[1], newPage[2], newPage[3]);
                    }
                    clipblocImport(newPage[1] + "::" + newPage[2] + "::" + newPage[3]);
                } else {
                    keepFromImport=false;
                    setTimeout(function() {

                        transitionEndFunc = function() {
                            if (newTransitionFunc) {
                                newTransitionFunc();
                            } else {
                                if (lastPage) {
                                    lastPage.style.overflow = "hidden";
                                    if (moveSense === "AV") {
                                        lastPage.style.left = "-100%";
                                        page.style.left = "0px";
                                    } else {
                                        lastPage.style.left = "100%";
                                        page.style.left = "0px";
                                    }

                                } else {
                                    page.style.left = "0px";
                                }
                            }

                            endTransPage = function() {

                                if (lastPage) {
                                    document.body.removeChild(lastPage);
                                }
                                transCreate = false;
                                lastPage = null;
                                endTransPage = null;
                                lastPage = page;
                                lastPage.addEventListener("transitionend", function(e) {
                                    if (endTransPage !== null) {
                                        endTransPage();
                                    }
                                }, false);
                                lastPage.addEventListener('webkitTransitionEnd', function() {
                                    // the same above
                                    if (endTransPage !== null) {
                                        endTransPage();
                                    }
                                });
                                if (submenu !== null && submenu !== "") {
                                    submenuExists = true;
                                } else {
                                    submenuExists = false;
                                }
                                if (!collapsed) {
                                    collapseMenu();
                                }
                                if (internalNavPage) {
                                    var pageSel = document.getElementById("page_" + internalNavPage);
                                    pageSel.click();

                                } else {
                                    if (afterTransitionFunc) {
                                        afterTransitionFunc();
                                    }
                                }
                            };
                        };
                        if (beforeTransitionFunc) {

                            beforeTransitionFunc(transitionEndFunc);
                        } else {

                            transitionEndFunc();
                        }

                    }, 10);
                }
            });

        });
    }


};

var submenuAppHide = false;
submenuApphideShow = function() {
    submenuAppHide = !submenuAppHide;
    if (submenuAppHide) {
        hideSubmenuApp();
    } else {
        showSubmenuApp();
    }
};
hideSubmenuApp = function() {
    if (typeof hideSubmenuFunc !== "undefined" && hideSubmenuFunc !== null) {
        hideSubmenuFunc();
    } else {
        submenuContainer = document.getElementById("submenuContainer");
        submenuContainer.style.left = -submenuContainer.offsetWidth + "px";
        var mainContent = document.getElementById("date");
        mainContent.style.left = "0";
        mainContent.style.width = "100%";
    }

};

hideSubmenu = function() {

    hideSubmenuApp();
    submenuAppHide = true;
    var mainContent = document.getElementById("date");
    if (document.getElementById("adContainner")) {
        document.getElementById("adContainner").className = "col-xs-2 nopadding";
        document.getElementById("adContainner").style.opacity = 0;
        document.getElementById("adContainner").style.height = "0px";
    }
    mainContent.className = "col-xs-12 nopadding generic_trans_basic";
    mainContent.style.width = "100%";
    if (window.innerWidth < 900) {
        document.getElementById("collapse-bar").style.opacity = 0;
    }
    menu = document.getElementById("menu");
    menu.style.opacity = 0;
    /*var footer=document.getElementById("footer");
     footer.className="col-xs-12 generic_trans_basic";
     footer.style.opacity=0;*/
    endTrans = function() {
        lastPage.style.top = 0;
        lastPage.style.paddingBottom = "0px";
        if (subMenuPB) {
            subMenuPB.className = "newShowHideSubMenu";
        }
    };

};

var menu = null;

hideMain = function() {

    var mainContent = document.getElementById("date");

    mainContent.style.width = "100%";
    if (document.getElementById("adContainner")) {
        document.getElementById("adContainner").style.opacity = 0;
        document.getElementById("adContainner").style.height = "0px";
    }
    if (window.innerWidth < 900) {
        document.getElementById("collapse-bar").style.opacity = 0;
    }
    menu = document.getElementById("menu");
    //menu.style.opacity = 0;
    mainContent.className = "col-xs-12 nopadding generic_trans_basic";
    /*var footer=document.getElementById("footer");
     footer.className="col-xs-12 generic_trans_basic";
     footer.style.opacity=0;*/

    //endTrans = function() {
    lastPage.style.top = 0;
    lastPage.style.paddingBottom = "0px";
    //}

};

showMain = function() {

    var mainContent = document.getElementById("date");
    if (lastPage) {
        if (window.innerWidth < 900) {
            if (collapsed) {
                topPos = document.getElementById("header").offsetHeight + document.getElementById("collapse-button").offsetHeight;

            } else {
                topPos = document.getElementById("menu").offsetHeight + document.getElementById("header").offsetHeight + document.getElementById("collapse-button").offsetHeight;
            }

        } else {
            topPos = document.getElementById("headerContainer").offsetHeight;
        }
        lastPage.style.top = topPos + "px";
        //lastPage.style.paddingBottom = document.getElementById("footer").offsetHeight + "px";
    }
    endTrans = function() {


        if (document.getElementById("adContainner")) {
            if (lastSubPage === null || (lastSubPage !== null && pageAd)) {
                if (window.innerWidth < 1280) {
                    document.getElementById("adContainner").style.opacity = 0;
                    mainContent.className = "col-xs-12 nopadding generic_trans_basic";
                } else {
                    document.getElementById("adContainner").style.opacity = 1;
                    mainContent.className = "col-xs-10 nopadding generic_trans_basic";
                    document.getElementById("adContainner").style.height = "100%";
                    mainContent.style.width = "83.33333333%";
                }

            }

        } else {
            mainContent.className = "col-xs-12 nopadding generic_trans_basic";
        }
        if (window.innerWidth < 900) {
            document.getElementById("collapse-bar").style.opacity = 1;
        }
        menu = document.getElementById("menu");
        menu.style.opacity = 1;
        var footer = document.getElementById("footer");
        footer.style.opacity = 1;
        endtrans = null;

        if (auxFunc !== null) {
            auxFunc();
        }
    };


};

var lastSubmenuWidth = "";
showSubmenuApp = function() {

    if (typeof showSubmenuFunc !== "undefined" && showSubmenuFunc !== null) {
        showSubmenuFunc();
    } else {
        submenuContainer = document.getElementById("submenuContainer");
        submenuContainer.style.opacity = 1;
        submenuContainer.style.left = "0";
        var mainContent = document.getElementById("date");
        mainContent.style.left = submenuContainer.offsetWidth + "px";
        mainContent.style.width = window.innerWidth - submenuContainer.offsetWidth + "px";
    }


};

showSubmenu = function() {
    if (subMenuPB) {
        subMenuPB.className = "";
    }
    var mainContent = document.getElementById("date");
    if (lastPage) {
        if (window.innerWidth < 900) {
            if (collapsed) {
                topPos = document.getElementById("header").offsetHeight + document.getElementById("collapse-button").offsetHeight;

            } else {
                topPos = document.getElementById("menu").offsetHeight + document.getElementById("header").offsetHeight + document.getElementById("collapse-button").offsetHeight;
            }

        } else {
            topPos = document.getElementById("headerContainer").offsetHeight;
        }
        lastPage.style.top = topPos + "px";
        //lastPage.style.paddingBottom = document.getElementById("footer").offsetHeight + "px";
    }
    if (document.getElementById("adContainner") && window.innerWidth >= 1280) {
        mainContent.style.width = "83.33333333%";
        mainContent.className = "col-xs-10 nopadding generic_trans_basic";
    }
    endTrans = function() {

        if (document.getElementById("adContainner") && (lastSubPage === null || (lastSubPage !== null && pageAd))) {
            if (window.innerWidth < 1280) {
                document.getElementById("adContainner").style.opacity = 0;
            } else {
                document.getElementById("adContainner").style.opacity = 1;
                mainContent.className = "col-xs-2 nopadding generic_trans_basic";
                document.getElementById("adContainner").style.height = "100%";
            }

        } else {

        }

        if (window.innerWidth < 900) {
            document.getElementById("collapse-bar").style.opacity = 1;
        }
        menu = document.getElementById("menu");
        menu.style.opacity = 1;
        var footer = document.getElementById("footer");
        footer.style.opacity = 1;
        endtrans = null;
        endTrans = function() {

            if (document.getElementById("adContainner")) {

            }
            if (auxFunc !== null) {
                auxFunc();
            }
        };
    };


};

var originalSubPage = "";
var lastSubPage = null;
var samePage = false;
var changeLast = true;
var createSubPage = function(name, content, submenu, date, _page, fb, counterVisible, clipbloc, ad, adCode) {
    contentClean = null;
    collapsed = true;
    pageAd = ad;
    if (document.getElementById("adContainner")) {
        document.getElementById("adContainner").style.opacity = 0;
    }
    document.getElementById("clipblocCount").style.display = "none";
    record_stats(date);
    if (submenu !== null && submenu !== "") {
        moveSense = "AV";
        subSectionTab = _page;
        samePage = true;
        /*if (antSection != null) {
         if (antSection.indexOf('menu') > -1) {
         document.getElementById(antSection).className = "innerMenu";
         } else {
         if(document.getElementById(antSection)){
         document.getElementById(antSection).className = "innerFoot";
         }
         }
         }*/
        changeLast = false;


        createPage(name, content, submenu, date, fb, counterVisible, clipbloc, ad, adCode);


    } else if (lastSubPage === null || "page_" + date !== lastSubPage.id) {
        pageTab = _page;
        moveSense = "AV";
        var page = document.createElement("div");
        page.className = "page generic_trans";
        page.id = name;
        page.style.left = "0";
        var container = document.getElementById("date");
        if (originalSubPage === "") {
            originalSubPage = container.innerHTML;
        }
       
            container.className = container.className + " generic_trans_basic";
            container.style.opacity = "0";
            if (lastSubPage) {
                lastSubPage.className = "innerSubmenu";
            }
            lastSubPage = document.getElementById("page_" + date);
            lastSubPage.className = "innerSubmenuSelected";
            endTrans = function() {
                 
                    endTrans = null;
                    container.appendChild(page);
                    var refresh = new Date().getTime();
                    $("#" + name).load("controller/proxy.php?url=../pages/" + date + ".html", function() {
                        //$("#" + name).load("./pages/" + date + ".html?" + refresh, function() {
                        if (ad) {
                            if (submenu !== null && submenu !== "") {
                                document.getElementById("date").className = "col-xs-10 nopadding";

                            }
                            createAdv(date, adCode);
                        }
                        var contentHTML = document.getElementById(name).innerHTML;
                        if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) || (clipbloc !== undefined && clipbloc !== "")) {

                            if ((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) {
                                var newPage = contentHTML.split("::");
                                var toNewPage = "../pages/" + newPage[2] + ".html";
                            } else {
                                toNewPage = "./editor/rmt/" + clipbloc + "/clipbloc.html";
                            }
                            if (submenu !== null && submenu !== "") {
                                submenuExists = true;
                            } else {
                                submenuExists = false;
                            }
                            if (importFunc) {
                                importFunc(newPage[1], newPage[2], newPage[3]);
                            }
                            clipblocImportSubPage(newPage[1] + "::" + newPage[2] + "::" + newPage[3] + "::", name, page, container, clipbloc, fb, counterVisible);
                        } else {
                             keepFromImport=false;
                            if (fb) {
                                document.getElementById("socialfb").style.display = "block";
                                //var fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/0/"+pageTab+"&refresh="+refresh;
                                var urlToShareArray=document.URL.split("?");
                                urlToShareArray.pop();
                                var urlToShare=urlToShareArray.join("/");
                                var fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
                                document.getElementById("targetFB").setAttribute("href", fbSharer);
                                shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
                            } else if (!fb || fb === "undefined") {
                                document.getElementById("socialfb").style.display = "none";
                            }
                            if (counterVisible) {
                                document.getElementById("clipblocCount").style.display = "block";
                            } else if (!counterVisible || counterVisible === "undefined") {
                                document.getElementById("clipblocCount").style.display = "none";
                            }
                            container.innerHTML = page.innerHTML;
                            transitionEndFunc = function() {
                                container.style.opacity = "1";
                                endTrans = function() {
                                    endTrans = null;
                                    transCreate = false;
                                    if (typeof CONFIG !== "undefined" && typeof CONFIG["closeSubMenuOnSelect"] !== "undefined" && CONFIG["closeSubMenuOnSelect"] === "true") {
                                        hideSubmenuApp();
                                        submenuAppHide = true;
                                    }
                                    if (afterTransitionFunc) {
                                        afterTransitionFunc();
                                    }
                                };
                            }; 
                            if (beforeTransitionFunc) {
                                beforeTransitionFunc(transitionEndFunc);
                            } else {
                                transitionEndFunc();
                            }
                        }
                    });

        };
    }
};

//submenus
var submenuContainer = null;
var subMenuPB = null;
var sectionGroup = null;
function menu_level_2() {
    var self = this;

    self.tabs = ko.observableArray();
    self.ini = function(tabs) {


        sectionGroup = tabs;
        var refresh = new Date().getTime();
        $.getJSON("./controller/environment/json/" + tabs + ".json?" + refresh, function(data) {
        }).complete(function(data) {
            if (data.responseJSON === null || data.responseJSON === undefined) {
                document.getElementById("submenuContainer").style.display = "none";
                document.body.removeChild(subMenuPB);
                subMenuPB = null;
            } else {
                if (!subMenuPB) {
                    subMenuPB = document.createElement("div");
                    subMenuPB.id = "showHideSubMenu";
                    subMenuPB.innerHTML = " •  •  • ";
                    subMenuPB.onclick = function() {
                        submenuApphideShow();
                    };

                    document.body.appendChild(subMenuPB);
                } else {
                    document.body.appendChild(subMenuPB);
                }
                self.tabs(data.responseJSON.items);
                if (typeof CONFIG !== "undefined" && typeof CONFIG["iniSubMenuHide"] !== "undefined" && CONFIG["iniSubMenuHide"] === "true") {
                    submenuAppHide = true;
                    submenuContainer = document.getElementById("submenuContainer");
                    submenuContainer.style.left = -submenuContainer.offsetWidth + "px";
                    var mainContent = document.getElementById("date");
                    mainContent.style.left = "0";
                    mainContent.style.width = "100%";
                } else {
                    submenuAppHide = false;
                    showSubmenuApp();
                }
            }
        });
    };

    self.SelSection = function(tab) {
        if (!transCreate) {
            transCreate = true;
            moveSense = "AV";
            var cont = 0;
            for (var j in self.tabs()) {
                if (self.tabs()[j] === tab) {
                    document.body.onmousemove = null;
                    createSubPage("page_menu_" + tab.date, tab.content, tab.submenu, tab.date, cont, tab.tabFb, tab.tabCounter, tab.clipbloc, tab.ad);
                    break;
                }
                cont++;
            }
        }
        if (internalNavPage) {
            fromHistory = true;
        } else if (fromHistory) {
            fromHistory = false;
        } else {
            historyDatePointer++;
            window.history.pushState(null, tab.content, "?" + historyDatePointer);
            if (lastPage.id.indexOf("page_menu_") >= -1) {
                historyDate[historyDatePointer] = [lastPage.id.replace("page_menu_", ""), tab.date, new Date().getTime()];
            } else {
                historyDate[historyDatePointer] = [lastPage.id.replace("page_foot_", ""), tab.date, new Date().getTime()];
            }
        }
        internalNavPage = null;


    };
    self.back = null;
}
;

sendEmail = function() {
    var textMail = document.getElementById("mailText");
    var params = "method=send_mail&message=" + textMail.value;
    loadXMLDoc('controller/webService10.php', params);
};

send_mail = function() {
    var message = document.getElementById("sended");
    message.style.display = "inline-block";
};

goSection = function(_focus) {
    focus = _focus;
    iniSections.SelNextSection();
};

var fixed = false;
fixContent = function() {
    fixed = !fixed;
    switch (fixed) {
        case true:
            document.body.onmousemove = null;
            document.getElementById("fixPB").innerHTML = rots["unfix"][lanTemp];
            document.getElementById("footerContainer").style.visibility = "hidden";
            if (menuVPB !== null) {
                document.body.removeChild(menuVPB);
                menuVPB = null;
                menuPBVisible = true;
            }
            if (submenuExists) {
                hideSubmenu();
            } else {
                hideMain();
            }
            break;
        case false:

            document.getElementById("footerContainer").style.visibility = "visible";
            document.getElementById("fixPB").innerHTML = rots["fix"][lanTemp];
            if (submenuExists) {
                showSubmenu();
            } else {
                showMain();
            }
            break;
    }
};

homeSection = function() {
    var home = document.getElementById(tabHome);
    home.click();
};

var collapsed = true;
var collapseBar = null;
var menuHorizontal = null;
menuResize = function() {
    collapseBar = document.getElementById("collapse-bar");
    menuHorizontal = document.getElementById("menuHorizontal");
    if (window.innerWidth < 900) {

        var x = document.querySelectorAll('.innerMenu');
        //var x = document.getElementsByClassName( 'innerMenu' );
        if (antSection && antSection.indexOf('menu') > -1) {
            selX = document.getElementById(antSection);
            selX.className = "innerMenuCollapsed tabSelectedCollapsed";
        } else if (antSection && antSection.indexOf('foot') > -1) {
            selX = document.getElementById(antSection);
            selX.className = "innerFoot tabSelected";
        }
        collapseBar.style.display = "block";
        for (var j in x) {
            if (x[j] == "[object HTMLDivElement]") {
                if (x[j].className) {
                }
                x[j].className = "innerMenuCollapsed";
            }
        }
        if (collapsed) {

            menuHorizontal.style.height = document.getElementById("collapse-button").offsetHeight + "px";
        }


    } else {
        collapsed = true;
        x = document.querySelectorAll('.innerMenuCollapsed');
        //x = document.getElementsByClassName( 'innerMenuCollapsed' );
        if (antSection && antSection.indexOf('menu') > -1) {
            selX = document.getElementById(antSection);
            selX.className = "innerMenu tabSelected";
        } else if (antSection && antSection.indexOf('foot') > -1) {
            selX = document.getElementById(antSection);
            selX.className = "innerFoot tabSelected";
        }
        collapseBar.style.display = "none";
        for (var j in x) {
            if (x[j] == "[object HTMLDivElement]") {
                x[j].className = "innerMenu";
            }
        }
        menuHorizontal.style.height = document.getElementById("menu").offsetHeight + "px";

        headerContainer.style.width = "100%";
        footerContainer.style.width = "100%";
        if (lastPage) {
            lastPage.style.width = "100%";
        }


    }
    document.getElementById("imgHeader").style.height = document.getElementById("header").offsetHeight + document.getElementById("menu").offsetHeight + document.getElementById("collapse-button").offsetHeight + "px";
    document.getElementById("collapse-bar").style.opacity = 1;
};

collapseMenu = function() {
    //problems in resizing when stablished auto to menuhorizontal height
    collapsed = !collapsed;
    switch (collapsed) {
        case false:
            topPos = document.getElementById("menu").offsetHeight + document.getElementById("header").offsetHeight + document.getElementById("collapse-button").offsetHeight;
            menuHorizontal.style.height = document.getElementById("menu").offsetHeight + document.getElementById("collapse-button").offsetHeight + "px";
            if (lastPage) {
                lastPage.style.top = topPos + "px";
                document.getElementById("imgHeader").style.height = topPos + "px";
            }
            break;
        default:
            topPos = document.getElementById("header").offsetHeight + document.getElementById("collapse-button").offsetHeight;
            if (lastPage) {
                lastPage.style.top = topPos + "px";
                document.getElementById("imgHeader").style.height = topPos + "px";
            }
            break;
    }
};

getDirectory = function() {
    var message = "";
    //hacemos la petición ajax 
    var obj = {};
    obj.url = document.URL.split("/admin")[0] + "/";
    $.ajax({
        url: 'http://clipbloc.com/register/list/webService_2.php',
        //usando GET because string has special characters
        type: 'GET',
        // Form data
        //datos del formulario
        //data: formData,
        data: obj,
        //mientras enviamos el archivo
        beforeSend: function() {
        },
        //una vez finalizado correctamente
        success: function(data) {
            var directoryDiv = document.getElementById("directory");
            var listclipblocs = data.split(",");
            for (var j in listclipblocs) {
                var divRef = document.createElement("div");
                var urlRef = document.createElement("a");
                urlRef.className = "urlDir";
                divRef.className = "divDirRef";
                urlRef.innerHTML = listclipblocs[j];
                urlRef.href = listclipblocs[j];
                urlRef.target = "_blank";
                divRef.appendChild(urlRef);
                directoryDiv.appendChild(divRef);
            }
        },
        //si ha ocurrido un error
        error: function() {
            directoryDiv = document.getElementById("directory");
            directoryDiv.innerHTML = directory["error"][lanTemp];
        }
    });
};

var directory = {
    "error": {"es": "No es posible acceder al directorio en estos momentos, por favor intentalo más tarde.", "en": "It is not possible access to the directory at this moment, please try it later."},
    "rot": {"es": "Directorio", "en": "Directory"},
    "descrip": {"es": "Listado de cliplocs que se están creando en este momento", "en": "clipblocs list at the moment."}
};



var clipblocBridge = function(_reference) {
    var bridgePage = _reference.split("::");
    if (lastPage.id !== "page_menu_" + bridgePage[2] + "_bridge") {
        iniSections.tabs().push({"rot": bridgePage[2], "desc": "empty", "image": "empty", "content": "basic", "active": true, "submenu": "", "subMenuId": null, "date": bridgePage[2] + "_bridge", "clipbloc": "", "privated": false, "adCode": ""});
        focus = iniSections.tabs().length - 1;
        iniSections.SelSectionBridge(iniSections.tabs()[focus], bridgePage[0], bridgePage[1], bridgePage[2]);
        iniSections.tabs().pop();
    }
};
var clipblocImport = function(_reference) {
    var bridgePage = _reference.split("::");
    iniSections.SelSectionImport(bridgePage[0], bridgePage[1], bridgePage[2]);
};
var clipblocImportSubPage = function(_reference, _name, _page, _container, _clipbloc, _fb, _counterVisible) {
    var bridgePage = _reference.split("::");
    iniSections.SelSectionImportSubPage(bridgePage[0], bridgePage[1], bridgePage[2], _name, _page, _container, _clipbloc, _fb, _counterVisible);
};
var bridgeActive = false;
var bridgeActivePath = null;
var bridgeRef = null;
var createPageBridge = function(_code, _oriPath, _clip, _target, name, content, submenu, date, fb, counterVisible, clipbloc, ad, adCode) {
    if (typeof bridgeWhileFunc !== "undefined" && bridgeWhileFunc) {
        bridgeWhileFunc(_code, _oriPath, _clip);
    }
    contentClean = null;
    pageAd = ad;
    transCreate = true;
    document.body.onmousemove = null;

    fbId = null;
    lastSubPage = null;
    originalSubPage = "";
    if (document.getElementById("menu_level_2")) {
        document.getElementById("mainContainer").id = "mainContainer_old";
        document.getElementById("submenuContainer").id = "submenuContainer_old";
        document.getElementById("menu_level_2").id = "old";
        document.getElementById("date").id = "date_old";
        document.getElementById("targetFB").id = "targetFB_old";
        if (document.getElementById("homeSection")) {
            document.getElementById("homeSection").id = "homeSection_old";
        }
        if (document.getElementById("socialfb")) {
            document.getElementById("socialfb").id = "socialfb_old";
        }
        if (document.getElementById("counter")) {
            document.getElementById("counter").id = "counter_old";
        }
        if (document.getElementById("clipblocCount")) {
            document.getElementById("clipblocCount").id = "clipblocCount_old";
        }
        if (document.getElementById("adContainner")) {
            document.getElementById("adContainner").id = "adContainner_old";
            document.getElementById("adContentContainner").id = "adContentContainner_old";
        }

    }

    var page = document.createElement("div");
    page.className = "page generic_trans";
    page.id = name;
    if (fixed) {
        page.style.top = "0";
    } else {
        page.style.top = topPos + "px";
    }

    //page.style.paddingBottom = document.getElementById("footer").offsetHeight + "px";
    if (lastPage && moveSense === "RE") {
        page.style.left = "-100%";
    } else {
        page.style.left = "100%";
    }
    document.body.appendChild(page);
    $("#" + name).load("controller/proxy.php?url=../pages/" + content + ".html", function(data) {
        //$("#" + name).load("./pages/" + content + ".html", function() {   
        if (typeof bridgeOkFunc !== "undefined") {
            bridgeOkFunc();
        } else {
            if (bridgeDiv) {
                bridgeDiv.click();
            }
        }
        var refresh = new Date().getTime();
        if (fb) {
            var urlToShareArray=document.URL.split("?");
                urlToShareArray.pop();
                var urlToShare=urlToShareArray.join("/");
            //fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/0&refresh="+refresh;
            fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
            shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
            document.getElementById("targetFB").setAttribute("href", fbSharer);
        } else if (!fb || fb === "undefined") {
            document.getElementById("socialfb").style.display = "none";
        }

        if (counterVisible) {
            document.getElementById("clipblocCount").style.display = "block";
        } else if (!counterVisible || counterVisible === "undefined") {
            document.getElementById("clipblocCount").style.display = "none";
        }
        if (submenu !== null && submenu !== "") {
            //document.body.appendChild(submenuContainer);
            submenuExists = true;
            var submenuClass = new menu_level_2();
            ko.applyBindings(submenuClass, document.getElementById("menu_level_2"));
            submenuClass.ini(submenu);
            document.getElementById("homeSection").innerHTML = tabHomeRot;
        } else {

            submenuExists = false;
            document.getElementById("menu_level_2").parentNode.style.display = "none";
            document.getElementById("date").className = "col-xs-12 nopadding";
            document.getElementById("submenuContainer").style.display = "none";
            if (subMenuPB) {
                document.body.removeChild(subMenuPB);
                subMenuPB = null;
            }

        }

        $("#date").load(_oriPath + "/admin/controller/environment/multipleUser/proxyBridge.php", {code: _code, target: _target, clip: _clip, oriPath: _oriPath}, function(data) {
            //$("#date").load("./pages/" + date + ".html?" + refresh, function() {

            if (data.indexOf("notPermitted") >= 0) {
                if (bridgeNOkFunc) {
                    bridgeNOkFunc();
                }
            } else if (data.indexOf("NOT EXISTS") >= 0) {
                if (typeof bridgeNOTExistsFunc !== "undefined") {
                    bridgeNOTExistsFunc();
                }
            } else {
                bridges[_oriPath + "::" + _target + "::" + _clip] = _code;
                bridgeActive = true;
                bridgeActivePath = _oriPath;
                bridgeRef = _clip;
            }
            if (ad) {
                if (submenu !== null && submenu !== "") {
                    document.getElementById("date").className = "col-xs-8 nopadding";

                } else {
                    document.getElementById("date").className = "col-xs-10 nopadding";
                }
                createAdv(date, adCode);
            }
            //record_stats(date);
            var contentHTML = document.getElementById("date").innerHTML;
            if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1)) {
                if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1)) {
                    var newPage = contentHTML.split("::");
                    var toNewPage = "../pages/" + newPage[2] + ".html";
                } else {
                    toNewPage = "./editor/rmt/" + clipbloc + "/clipbloc.html";
                }
                if (importFunc) {
                    importFunc(newPage[1], newPage[2], newPage[3]);
                }
                setTimeout(function() {
                    
                    
                    
                    
                    transitionEndFunc = function() {
                        if (newTransitionFunc) {
                            newTransitionFunc();
                        } else {
                            if (lastPage) {
                                lastPage.style.overflow = "hidden";
                                if (moveSense === "AV") {
                                    lastPage.style.left = "-100%";
                                    page.style.left = "0px";
                                } else {
                                    lastPage.style.left = "100%";
                                    page.style.left = "0px";
                                }

                            } else {
                                page.style.left = "0px";
                            }
                        }

                        endTransPage = function() {
                            var container = document.getElementById("htmlContent");
                            pageImport = page;
                            clipblocImport(newPage[1] + "::" + newPage[2] + "::" + newPage[3] + "::");
                            if (lastPage) {
                                document.body.removeChild(lastPage);
                            }
                            transCreate = false;
                            lastPage = null;
                            endTransPage = null;
                            lastPage = page;
                            lastPage.addEventListener("transitionend", function(e) {
                                if (endTransPage !== null) {
                                    endTransPage();
                                }
                            }, false);
                            lastPage.addEventListener('webkitTransitionEnd', function() {
                                // the same above
                                if (endTransPage !== null) {
                                    endTransPage();
                                }
                            });
                            if (submenu !== null && submenu !== "") {
                                submenuExists = true;
                            } else {
                                submenuExists = false;
                            }
                            if (!collapsed) {
                                collapseMenu();
                            }
                            if (internalNavPage) {
                                var pageSel = document.getElementById("page_" + internalNavPage);
                                pageSel.click();

                            } else {
                                if (afterTransitionFunc) {
                                    afterTransitionFunc();
                                }
                            }
                            if (typeof bridgeOkEndFunc !== "undefined") {
                                bridgeOkEndFunc();
                            }
                        };
                    };
                    if (beforeTransitionFunc) {
                        beforeTransitionFunc(transitionEndFunc);
                    } else {
                        transitionEndFunc();
                    }

                }, 10);


            } else {
                 keepFromImport=false;
                setTimeout(function() {
                    transitionEndFunc = function() {
                        if (newTransitionFunc) {
                            newTransitionFunc();
                        } else {
                            if (lastPage) {
                                lastPage.style.overflow = "hidden";
                                if (moveSense === "AV") {
                                    lastPage.style.left = "-100%";
                                    page.style.left = "0px";
                                } else {
                                    lastPage.style.left = "100%";
                                    page.style.left = "0px";
                                }

                            } else {
                                page.style.left = "0px";
                            }
                        }

                        endTransPage = function() {

                            if (lastPage) {
                                document.body.removeChild(lastPage);
                            }
                            transCreate = false;
                            lastPage = null;
                            endTransPage = null;
                            lastPage = page;
                            lastPage.addEventListener("transitionend", function(e) {
                                if (endTransPage !== null) {
                                    endTransPage();
                                }
                            }, false);
                            lastPage.addEventListener('webkitTransitionEnd', function() {
                                // the same above
                                if (endTransPage !== null) {
                                    endTransPage();
                                }
                            });
                            if (submenu !== null && submenu !== "") {
                                submenuExists = true;
                            } else {
                                submenuExists = false;
                            }
                            if (!collapsed) {
                                collapseMenu();
                            }
                            if (internalNavPage) {
                                var pageSel = document.getElementById("page_" + internalNavPage);
                                pageSel.click();

                            } else {
                                if (afterTransitionFunc) {
                                    afterTransitionFunc();
                                }
                            }
                            if (typeof bridgeOkEndFunc !== "undefined") {
                                bridgeOkEndFunc();
                            }
                        };
                    };
                    if (beforeTransitionFunc) {
                        beforeTransitionFunc(transitionEndFunc);
                    } else {
                        transitionEndFunc();
                    }

                }, 10);
            }

        });




    });








};
var bridges = {};
var defaultNoBridge = function() {
    alert(bridgeRots["no"][lanTemp]);
};
var bridgeOpen = null;
var showBridgeLogin = function(_oriPath, _target, _clip) {

    if (bridges[_oriPath + "::" + _target + "::" + _clip]) {
        bridgeOpen(bridges[_oriPath + "::" + _target + "::" + _clip]);
    } else {
        if (typeof bridgeLoginFunc !== "undefined") {
            bridgeLoginFunc();
        } else {
            goBridge();
        }
    }


};
var pageImport = null;
var createPageImport = function(_code, _oriPath, _clip, _target) {
    $("#date").load(_oriPath + "/admin/controller/environment/multipleUser/proxyImport.php", {"code": _code, "target": _target, "clip": _clip, "oriPath": _oriPath}, function(data) {

        if (data.indexOf("notPermitted") >= 0) {
            if (bridgeNOkFunc) {
                bridgeNOkFunc();
            }
        } else if (data.indexOf("NOT EXISTS") >= 0) {
            if (typeof bridgeNOTExistsFunc !== "undefined") {
                bridgeNOTExistsFunc();
            }
        } else {
            imports[_oriPath + "::" + _target + "::" + _clip] = _code;
        }
        //record_stats(date);
        if (importDiv) {
            importing = false;
            importDiv.click();

        }
        var contentHTML = document.getElementById("date").innerHTML;
        if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1)) {
            if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1)) {
                var newPage = contentHTML.split("::");
                var toNewPage = "../pages/" + newPage[2] + ".html";
            } else {
                toNewPage = "./editor/rmt/" + clipbloc + "/clipbloc.html";
            }
            var container = document.getElementById("htmlContent");
            if (importFunc) {
                importFunc(newPage[1], newPage[2], newPage[3]);
            }
            clipblocImport(newPage[1] + "::" + newPage[2] + "::" + newPage[3]);
        } else {
            keepFromImport=false;
            setTimeout(function() {
                transitionEndFunc = function() {
                    if (newTransitionFunc) {
                        newTransitionFunc();
                    } else {
                        if (lastPage) {
                            lastPage.style.overflow = "hidden";
                            if (moveSense === "AV") {
                                lastPage.style.left = "-100%";
                                pageImport.style.left = "0px";
                            } else {
                                lastPage.style.left = "100%";
                                pageImport.style.left = "0px";
                            }

                        } else {
                            pageImport.style.left = "0px";
                        }
                    }

                    endTransPage = function() {

                        if (lastPage) {
                            document.body.removeChild(lastPage);
                        }
                        transCreate = false;
                        lastPage = null;
                        endTransPage = null;
                        lastPage = pageImport;
                        lastPage.addEventListener("transitionend", function(e) {
                            if (endTransPage !== null) {
                                endTransPage();
                            }
                        }, false);
                        lastPage.addEventListener('webkitTransitionEnd', function() {
                            // the same above
                            if (endTransPage !== null) {
                                endTransPage();
                            }
                        });
                        if (!collapsed) {
                            collapseMenu();
                        }
                        if (internalNavPage) {
                            var pageSel = document.getElementById("page_" + internalNavPage);
                            pageSel.click();

                        } else {
                            if (afterTransitionFunc) {
                                afterTransitionFunc();
                            }
                        }
                        if (typeof bridgeOkEndFunc !== "undefined") {
                            bridgeOkEndFunc();
                        }
                    };
                };
                if (beforeTransitionFunc) {
                    beforeTransitionFunc(transitionEndFunc);
                } else {
                    transitionEndFunc();
                }

            }, 10);
        }

    });


};
var createSubPageImport = function(_code, _oriPath, _clip, _target, _name, _page, _container, _clipbloc, _fb, _counterVisible) {
    $("#" + _name).load(_oriPath + "/admin/controller/environment/multipleUser/proxyImport.php", {"code": _code, "target": _target, "clip": _clip, "oriPath": _oriPath}, function(data) {

        if (data.indexOf("notPermitted") >= 0) {
            if (bridgeNOkFunc) {
                bridgeNOkFunc();
            }
        } else if (data.indexOf("NOT EXISTS") >= 0) {
            if (typeof bridgeNOTExistsFunc !== "undefined") {
                bridgeNOTExistsFunc();
            }
        } else {
            imports[_oriPath + "::" + _target + "::" + _clip] = _code;
        }
        //record_stats(date);
        if (importDiv) {
            importing = false;
            importDiv.click();

        }


        if (_code !== null && _code !== "") {
            
            var contentHTML = document.getElementById(_name).innerHTML;

            if (((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) || (_clipbloc !== undefined && _clipbloc !== "")) {
                if ((typeof keepFromImport==="undefined" || !keepFromImport) && contentHTML.indexOf("clipblocImport::") > -1) {
                    var newPage = contentHTML.split("::");
                    var toNewPage = "../pages/" + newPage[2] + ".html";
                } else {
                    toNewPage = "./editor/rmt/" + clipbloc + "/clipbloc.html";
                }
                if (importFunc) {
                    importFunc(newPage[1], newPage[2], newPage[3]);
                }
                clipblocImportSubPage(newPage[1] + "::" + newPage[2] + "::" + newPage[3] + "::", _name, _page, _container, _clipbloc, _fb, _counterVisible);
                    

            } else {
                keepFromImport=false;
                if (importEndFunc) {
                    importEndFunc(_oriPath, _clip, _target);
                }
                if (_fb) {
                    document.getElementById("socialfb").style.display = "block";
                    //var fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/0/"+pageTab+"&refresh="+refresh;
                    var urlToShareArray=document.URL.split("?");
                urlToShareArray.pop();
                var urlToShare=urlToShareArray.join("/");
                    var fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
                    document.getElementById("targetFB").setAttribute("href", fbSharer);
                    shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
                } else if (!_fb || _fb === "undefined") {
                    document.getElementById("socialfb").style.display = "none";
                }
                if (_counterVisible) {
                    document.getElementById("clipblocCount").style.display = "block";
                } else if (!_counterVisible || _counterVisible === "undefined") {
                    document.getElementById("clipblocCount").style.display = "none";
                }

                 transitionEndFunc = function() {
                    _container.innerHTML = _page.innerHTML;
                    _container.style.opacity = "1";
                    endTrans = function() {
                        endTrans = null;
                        transCreate = false;
                        if (typeof CONFIG !== "undefined" && typeof CONFIG["closeSubMenuOnSelect"] !== "undefined" && CONFIG["closeSubMenuOnSelect"] === "true") {
                            hideSubmenuApp();
                            submenuAppHide = true;
                        }
                        if (afterTransitionFunc) {
                            afterTransitionFunc();
                        }
                    };
                }; 
                if (beforeTransitionFunc) {
                    beforeTransitionFunc(transitionEndFunc);
                } else {
                    transitionEndFunc();
                }
            }
        } else {
            if (importEndFunc) {
                importEndFunc(_oriPath, _clip, _target);
            }
            if (_fb) {
                document.getElementById("socialfb").style.display = "block";
                //var fbSharer="http://www.facebook.com/sharer.php?u="+document.URL+"pages/"+date+"/facebook.html?v="+sectionTab+"/"+subSectionTab+"/0/"+pageTab+"&refresh="+refresh;
                 var urlToShareArray=document.URL.split("?");
                urlToShareArray.pop();
                var urlToShare=urlToShareArray.join("/");
                var fbSharer = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html?refresh=" + refresh;
                document.getElementById("targetFB").setAttribute("href", fbSharer);
                shareURL = "http://www.facebook.com/sharer.php?u=" + urlToShare + "pages/" + date + "/facebook.html";
            } else if (!_fb || _fb === "undefined") {
                document.getElementById("socialfb").style.display = "none";
            }
            if (_counterVisible) {
                document.getElementById("clipblocCount").style.display = "block";
            } else if (!_counterVisible || _counterVisible === "undefined") {
                document.getElementById("clipblocCount").style.display = "none";
            }

            transitionEndFunc = function() {
                _container.innerHTML = _page.innerHTML;
                _container.style.opacity = "1";
                endTrans = function() {
                    endTrans = null;
                    transCreate = false;
                    if (typeof CONFIG !== "undefined" && typeof CONFIG["closeSubMenuOnSelect"] !== "undefined" && CONFIG["closeSubMenuOnSelect"] === "true") {
                        hideSubmenuApp();
                        submenuAppHide = true;
                    }
                    if (afterTransitionFunc) {
                        afterTransitionFunc();
                    }
                };
            }; 
            if (beforeTransitionFunc) {
                beforeTransitionFunc(transitionEndFunc);
            } else {
                transitionEndFunc();
            }

            /*_container.innerHTML = _page.innerHTML;
            _container.style.opacity = "1";
            endTrans = function() {
                endTrans = null;
                transCreate = false;
                if (afterTransitionFunc) {
                    afterTransitionFunc();
                }
            };*/
        }


    });

}
var imports = {};
var defaultNoImport = function() {
    alert(importRots["no"][lanTemp]);
};
var importOpen = null;
var importing = false;
var showImportLogin = function(_oriPath, _target, _clip) {

    if (imports[_oriPath + "::" + _target + "::" + _clip]) {
        openImport(imports[_oriPath + "::" + _target + "::" + _clip]);
    } else {
        importing = true;
        if (typeof importLoginFunc !== "undefined") {
            importLoginFunc();
        } else {
            goImport(_oriPath + "::" + _clip);
        }
    }


};
/* 
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
var lan="es";
var areaW = 0;
var areaH = 0;
var leftFunction = null;
var rightFunction = null;
var upFunction = null;
var downFunction = null;
var noneFunction = null;
var endTrans = null;
var auxEndTrans = null;
var keyboard=null;
var key=null;
window.onload = function() {
    changeOri = function() {

    }
    
    

    // Listen for orientation changes
    window.addEventListener("orientationchange", changeOri, false);

   document.addEventListener("transitionend", function(e) {
        if (endTrans != null) {
            endTrans();
        }
    }, false);
    document.addEventListener('webkitTransitionEnd', function() {
        // the same above
        if (endTrans != null) {
            endTrans();
        }
    });
    //second trans listener
    document.addEventListener("transitionend", function(e) {
        if (auxEndTrans != null) {
            auxEndTrans();
        }
    }, false);
    document.addEventListener('webkitTransitionEnd', function() {
        // the same above
        if (auxEndTrans != null) {
            auxEndTrans();
        }
    });
    

    keypress = function(e) {
        key = e.keyCode ? e.keyCode : e.which;
        if(keyboard){
            keyboard();
        }
       
    }
    document.onkeypress=keypress;

    swipedetect(window, function(swipedir) {
        switch (swipedir) {
            case "left":
                if (leftFunction != undefined) {
                    eval(leftFunction)();
                }
                break;
            case "right":
                if (rightFunction != undefined) {
                    eval(rightFunction)();
                }
                break;
            case "up":
                if (upFunction != undefined) {
                    eval(upFunction)();
                }
                break;
            case "down":
                if (downFunction != undefined) {
                    eval(downFunction)();
                }
                break;
            case "none":
                if (noneFunction != undefined) {
                    eval(noneFunction)();
                }
                break;
        }
    }
    );
            
    leftFunction=function(){
        //alert("derecha")
    }
    rightFunction=function(){
        //alert("derecha")
    }
    upFunction=function(){
        //alert("derecha")
    }
    downFunction=function(){
        //alert("derecha")
    }
    noneFunction=function(){
        //alert("none")
    }
    applyConfig();
}
var CONFIG;
var oldMenuHorizontalCss=null;
var oldInnerMenu=null;
function applyConfig() {
    var refresh = new Date().getTime();
    $.getJSON("./controller/environment/json/config.json?" + refresh, function(data) {
    }).complete(function(data) {
        if (data.responseJSON.items) {
            CONFIG = data.responseJSON.items[0];
            for (var j in data.responseJSON.items) {
                CONFIG[data.responseJSON.items[j].rot] = data.responseJSON.items[j].content;
            }
        }
        /*if(CONFIG["menuHorizontalOri"] && CONFIG["menuHorizontalOri"]!=null && CONFIG["menuHorizontalOri"]!=undefined && CONFIG["menuHorizontalOri"]!="H"){
            
            var sheet = document.styleSheets[0];
            
            var typeMenu="menuHorizontalCss"+CONFIG['menuHorizontalOri'];
            var typeInner="innerMenuCss"+CONFIG['menuHorizontalOri'];
            sheet.insertRule("#menuHorizontal { "+CONFIG[typeMenu]+" }", 1);
            sheet.insertRule(".innerMenu{ display:"+CONFIG[typeInner]+" }", 72);
            var menuH=document.getElementById("menuHorizontal");
            document.body.appendChild(menuH); 
            
        }*/
        
        admin_core();
    })
}
